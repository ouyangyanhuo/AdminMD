var MXI_DEBUG=!0;
(function(R,Q){function aa(l,m){for(var f,c=[],a=0;a<l.length;++a){if(!(f=V[l[a]]))a:{f=R;for(var e=l[a].split(/[.\/]/),b=0;b<e.length;++b){if(!f[e[b]]){f=void 0;break a}f=f[e[b]]}}if(!f)throw"module definition dependecy not found: "+l[a];c.push(f)}m.apply(null,c)}function C(l,m,f){if("string"!==typeof l)throw"invalid module definition, module id must be defined and be a string";if(m===Q)throw"invalid module definition, dependencies must be specified";if(f===Q)throw"invalid module definition, definition function must be specified";aa(m,
function(){V[l]=f.apply(null,arguments)})}var V={};C("moxie/core/utils/Basic",[],function(){var l=function(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},m=function(a){f(arguments,function(e,b){0<b&&f(e,function(g,d){void 0!==g&&(l(a[d])===l(g)&&~c(l(g),["array","object"])?m(a[d],g):a[d]=g)})});return a},f=function(a,e){var b;if(a)if("number"===l(a.length)){var g=0;for(b=a.length;g<b&&!1!==e(a[g],g);g++);}else if("object"===
l(a))for(b in a)if(a.hasOwnProperty(b)&&!1===e(a[b],b))break},c=function(a,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,a);for(var b=0,g=e.length;b<g;b++)if(e[b]===a)return b}return-1};return{guid:function(){var a=0;return function(e){var b=(new Date).getTime().toString(32),g;for(g=0;5>g;g++)b+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+b+(a++).toString(32)}}(),typeOf:l,extend:m,each:f,isEmptyObj:function(a){var e;if(!a||"object"!==l(a))return!0;for(e in a)return!1;
return!0},inSeries:function(a,e){function b(d){if("function"===l(a[d]))a[d](function(k){++d<g&&!k?b(d):e(k)})}var g=a.length;"function"!==l(e)&&(e=function(){});a&&a.length||e();b(0)},inParallel:function(a,e){var b=0,g=a.length,d=Array(g);f(a,function(k,p){k(function(h){if(h)return e(h);var q=[].slice.call(arguments);q.shift();d[p]=q;b++;b===g&&(d.unshift(null),e.apply(this,d))})})},inArray:c,arrayDiff:function(a,e){var b=[];"array"!==l(a)&&(a=[a]);"array"!==l(e)&&(e=[e]);for(var g in a)-1===c(a[g],
e)&&b.push(a[g]);return b.length?b:!1},arrayIntersect:function(a,e){var b=[];f(a,function(g){-1!==c(g,e)&&b.push(g)});return b.length?b:null},toArray:function(a){var e,b=[];for(e=0;e<a.length;e++)b[e]=a[e];return b},trim:function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},sprintf:function(a){var e=[].slice.call(arguments,1);return a.replace(/%[a-z]/g,function(){var b=e.shift();return"undefined"!==l(b)?b:""})},parseSizeStr:function(a){if("string"!==
typeof a)return a;var e={t:1099511627776,g:1073741824,m:1048576,k:1024};a=/^([0-9\.]+)([tmgk]?)$/.exec(a.toLowerCase().replace(/[^0-9\.tmkg]/g,""));var b=a[2];a=+a[1];e.hasOwnProperty(b)&&(a*=e[b]);return Math.floor(a)}}});C("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(l){var m=function(e){var b={has:function(n,w){return-1!==w.toLowerCase().indexOf(n.toLowerCase())},lowerize:function(n){return n.toLowerCase()}},g=function(){for(var n,w=0,r,u,v,x,t,y=arguments;w<y.length;w+=2){t=y[w];
var B=y[w+1];if("undefined"===typeof n)for(v in n={},B)r=B[v],"object"===typeof r?n[r[0]]=e:n[r]=e;for(r=u=0;r<t.length;r++)if(x=t[r].exec(this.getUA())){for(v=0;v<B.length;v++)t=x[++u],r=B[v],"object"===typeof r&&0<r.length?2==r.length?n[r[0]]="function"==typeof r[1]?r[1].call(this,t):r[1]:3==r.length?n[r[0]]="function"!==typeof r[1]||r[1].exec&&r[1].test?t?t.replace(r[1],r[2]):e:t?r[1].call(this,t,r[2]):e:4==r.length&&(n[r[0]]=t?r[3].call(this,t.replace(r[1],r[2])):e):n[r]=t?t:e;break}if(x)break}return n},
d=function(n,w){for(var r in w)if("object"===typeof w[r]&&0<w[r].length)for(var u=0;u<w[r].length;u++){if(b.has(w[r][u],n))return"?"===r?e:r}else if(b.has(w[r],n))return"?"===r?e:r;return n},k={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2E3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},p=[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],["name","version"],[/\s(opr)\/([\w\.]+)/i],
[["name","Opera"],"version"],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],["name","version"],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[["name","IE"],"version"],[/(edge)\/((\d+)?[\w\.]+)/i],["name","version"],[/(yabrowser)\/([\w\.]+)/i],[["name",
"Yandex"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],["name","version"],[/(dolfin)\/([\w\.]+)/i],[["name","Dolphin"],"version"],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[["name","Chrome"],"version"],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],["version",["name","Android Browser"]],
[/FBAV\/([\w\.]+);/i],["version",["name","Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",d,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name",
"Netscape"],"version"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],h=[[/windows.+\sedge\/([\w\.]+)/i],["version",["name",
"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv:([\w\.]+).*(gecko)/i],["version","name"]],q=[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],["name",["version",d,k]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",
d,k]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palmos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name","Symbian"],"version"],[/\((series40);/i],["name"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,
/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name",
"iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[["name","Mac OS"],["version",/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return function(n){var w=n||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return g.apply(this,
p)};this.getEngine=function(){return g.apply(this,h)};this.getOS=function(){return g.apply(this,q)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return w};this.setUA=function(r){w=r;return this};this.setUA(w)}}(),f=function(){var e={define_property:!1,create_canvas:function(){var b=document.createElement("canvas");return!(!b.getContext||!b.getContext("2d"))}(),return_response_type:function(b){try{if(-1!==
l.inArray(b,["","text","document"]))return!0;if(window.XMLHttpRequest){var g=new XMLHttpRequest;g.open("get","/");if("responseType"in g)return g.responseType=b,g.responseType!==b?!1:!0}}catch(d){}return!1},use_data_uri:function(){var b=new Image;b.onload=function(){e.use_data_uri=1===b.width&&1===b.height};setTimeout(function(){b.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==
a.browser||9<=a.version)},use_data_uri_of:function(b){return e.use_data_uri&&33E3>b||e.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var b=document.createElement("input");b.setAttribute("type","file");return!b.disabled}};return function(b){var g=[].slice.call(arguments);g.shift();return"function"===l.typeOf(e[b])?e[b].apply(this,
g):!!e[b]}}(),c=(new m).getResult(),a={can:f,uaParser:m,browser:c.browser.name,version:c.browser.version,os:c.os.name,osVersion:c.os.version,verComp:function(e,b,g){var d=0,k=0,p=0,h={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1};d=function(n){n=(""+n).replace(/[_\-+]/g,".");n=n.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return n.length?n.split("."):[-8]};var q=function(n){return n?isNaN(n)?h[n]||-7:parseInt(n,10):0};e=d(e);b=d(b);k=Math.max(e.length,b.length);for(d=0;d<
k;d++)if(e[d]!=b[d])if(e[d]=q(e[d]),b[d]=q(b[d]),e[d]<b[d]){p=-1;break}else if(e[d]>b[d]){p=1;break}if(!g)return p;switch(g){case ">":case "gt":return 0<p;case ">=":case "ge":return 0<=p;case "<=":case "le":return 0>=p;case "==":case "=":case "eq":return 0===p;case "<>":case "!=":case "ne":return 0!==p;case "":case "<":case "lt":return 0>p;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};
a.OS=a.os;MXI_DEBUG&&(a.debug={runtime:!0,events:!1},a.log=function(){var e=arguments[0];"string"===l.typeOf(e)&&(e=l.sprintf.apply(this,arguments));if(window&&window.console&&window.console.log)window.console.log(e);else if(document){var b=document.getElementById("moxie-console");b||(b=document.createElement("pre"),b.id="moxie-console",document.body.appendChild(b));l.inArray(l.typeOf(e),["object","array"]);b.appendChild(document.createTextNode(e+"\n"))}});return a});C("moxie/core/I18n",["moxie/core/utils/Basic"],
function(l){var m={};return{addI18n:function(f){return l.extend(m,f)},translate:function(f){return m[f]||f},_:function(f){return this.translate(f)},sprintf:function(f){var c=[].slice.call(arguments,1);return f.replace(/%[a-z]/g,function(){var a=c.shift();return"undefined"!==l.typeOf(a)?a:""})}}});C("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(l,m){var f={mimes:{},extensions:{},addMimeType:function(c){c=c.split(/,/);var a,e;for(a=0;a<c.length;a+=2){var b=c[a+1].split(/ /);
for(e=0;e<b.length;e++)this.mimes[b[e]]=c[a];this.extensions[c[a]]=b}},extList2mimes:function(c,a){var e,b,g,d=[];for(e=0;e<c.length;e++){var k=c[e].extensions.split(/\s*,\s*/);for(b=0;b<k.length;b++){if("*"===k[b])return[];(g=this.mimes[k[b]])&&-1===l.inArray(g,d)&&d.push(g);if(a&&/^\w+$/.test(k[b]))d.push("."+k[b]);else if(!g)return[]}}return d},mimes2exts:function(c){var a=this,e=[];l.each(c,function(b){if("*"===b)return e=[],!1;var g=b.match(/^(\w+)\/(\*|\w+)$/);g&&("*"===g[2]?l.each(a.extensions,
function(d,k){(new RegExp("^"+g[1]+"/")).test(k)&&[].push.apply(e,a.extensions[k])}):a.extensions[b]&&[].push.apply(e,a.extensions[b]))});return e},mimes2extList:function(c){var a=[];"string"===l.typeOf(c)&&(c=l.trim(c).split(/\s*,\s*/));var e=this.mimes2exts(c);a.push({title:m.translate("Files"),extensions:e.length?e.join(","):"*"});a.mimes=c;return a},getFileExtension:function(c){return(c=c&&c.match(/\.([^.]+)$/))?c[1].toLowerCase():""},getFileMime:function(c){return this.mimes[this.getFileExtension(c)]||
""}};f.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
return f});C("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(l){var m=function(f,c){return f.className?(new RegExp("(^|\\s+)"+c+"(\\s+|$)")).test(f.className):!1};return{get:function(f){return"string"!==typeof f?f:document.getElementById(f)},hasClass:m,addClass:function(f,c){m(f,c)||(f.className=f.className?f.className.replace(/\s+$/,"")+" "+c:c)},removeClass:function(f,c){f.className&&(f.className=f.className.replace(new RegExp("(^|\\s+)"+c+"(\\s+|$)"),function(a,e,b){return" "===e&&" "===
b?" ":""}))},getStyle:function(f,c){if(f.currentStyle)return f.currentStyle[c];if(window.getComputedStyle)return window.getComputedStyle(f,null)[c]},getPos:function(f,c){function a(k){var p=0;var h=0;k&&(h=k.getBoundingClientRect(),k="CSS1Compat"===d.compatMode?d.documentElement:d.body,p=h.left+k.scrollLeft,h=h.top+k.scrollTop);return{x:p,y:h}}var e=0,b=0,g,d=document;c=c||d.body;if(f&&f.getBoundingClientRect&&"IE"===l.browser&&(!d.documentMode||8>d.documentMode))return f=a(f),c=a(c),{x:f.x-c.x,y:f.y-
c.y};for(g=f;g&&g!=c&&g.nodeType;)e+=g.offsetLeft||0,b+=g.offsetTop||0,g=g.offsetParent;for(g=f.parentNode;g&&g!=c&&g.nodeType;)e-=g.scrollLeft||0,b-=g.scrollTop||0,g=g.parentNode;return{x:e,y:b}},getSize:function(f){return{w:f.offsetWidth||f.clientWidth,h:f.offsetHeight||f.clientHeight}}}});C("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(l){function m(f,c){for(var a in f)if(f[a]===c)return a;return null}return{RuntimeError:function(){function f(a){this.code=a;this.name=m(c,a);this.message=
this.name+": RuntimeError "+this.code}var c={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};l.extend(f,c);f.prototype=Error.prototype;return f}(),OperationNotAllowedException:function(){function f(c){this.code=c;this.name="OperationNotAllowedException"}l.extend(f,{NOT_ALLOWED_ERR:1});f.prototype=Error.prototype;return f}(),ImageError:function(){function f(a){this.code=a;this.name=m(c,a);this.message=this.name+": ImageError "+this.code}var c={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};l.extend(f,
c);f.prototype=Error.prototype;return f}(),FileException:function(){function f(a){this.code=a;this.name=m(c,a);this.message=this.name+": FileException "+this.code}var c={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};l.extend(f,c);f.prototype=Error.prototype;return f}(),DOMException:function(){function f(a){this.code=a;this.name=m(c,a);this.message=this.name+": DOMException "+this.code}var c={INDEX_SIZE_ERR:1,
DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};l.extend(f,c);
f.prototype=Error.prototype;return f}(),EventException:function(){function f(c){this.code=c;this.name="EventException"}l.extend(f,{UNSPECIFIED_EVENT_TYPE_ERR:0});f.prototype=Error.prototype;return f}()}});C("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(l,m,f){function c(){var a={};f.extend(this,{uid:null,init:function(){this.uid||(this.uid=f.guid("uid_"))},addEventListener:function(e,b,g,d){var k=this;this.hasOwnProperty("uid")||(this.uid=
f.guid("uid_"));e=f.trim(e);if(/\s/.test(e))f.each(e.split(/\s+/),function(h){k.addEventListener(h,b,g,d)});else{e=e.toLowerCase();g=parseInt(g,10)||0;var p=a[this.uid]&&a[this.uid][e]||[];p.push({fn:b,priority:g,scope:d||this});a[this.uid]||(a[this.uid]={});a[this.uid][e]=p}},hasEventListener:function(e){return(e=e?a[this.uid]&&a[this.uid][e]:a[this.uid])?e:!1},removeEventListener:function(e,b){e=e.toLowerCase();var g=a[this.uid]&&a[this.uid][e],d;if(g){if(b)for(d=g.length-1;0<=d;d--){if(g[d].fn===
b){g.splice(d,1);break}}else g=[];g.length||(delete a[this.uid][e],f.isEmptyObj(a[this.uid])&&delete a[this.uid])}},removeAllEventListeners:function(){a[this.uid]&&delete a[this.uid]},dispatchEvent:function(e){var b,g={},d=!0;if("string"!==f.typeOf(e)){var k=e;if("string"===f.typeOf(k.type))e=k.type,void 0!==k.total&&void 0!==k.loaded&&(g.total=k.total,g.loaded=k.loaded),g.async=k.async||!1;else throw new m.EventException(m.EventException.UNSPECIFIED_EVENT_TYPE_ERR);}-1!==e.indexOf("::")?function(q){b=
q[0];e=q[1]}(e.split("::")):b=this.uid;e=e.toLowerCase();if(k=a[b]&&a[b][e]){k.sort(function(q,n){return n.priority-q.priority});var p=[].slice.call(arguments);p.shift();g.type=e;p.unshift(g);MXI_DEBUG&&l.debug.events&&l.log("Event '%s' fired on %u",g.type,b);var h=[];f.each(k,function(q){p[0].target=q.scope;g.async?h.push(function(n){setTimeout(function(){n(!1===q.fn.apply(q.scope,p))},1)}):h.push(function(n){n(!1===q.fn.apply(q.scope,p))})});h.length&&f.inSeries(h,function(q){d=!q})}return d},bind:function(){this.addEventListener.apply(this,
arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(e){var b=this;this.bind(e.join(" "),function(g){var d="on"+g.type.toLowerCase();"function"===f.typeOf(this[d])&&this[d].apply(this,arguments)});f.each(e,function(g){g="on"+g.toLowerCase(g);"undefined"===f.typeOf(b[g])&&(b[g]=null)})}})}c.instance=new c;return c});
C("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(l,m,f,c){function a(g,d,k,p,h){var q=this,n=m.guid(d+"_");h=h||"browser";g=g||{};b[n]=this;k=m.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,
select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},k);g.preferred_caps&&(h=a.getMode(p,g.preferred_caps,h));MXI_DEBUG&&l.debug.runtime&&l.log("\tdefault mode: %s",h);var w=function(){var r={};return{exec:function(u,v,x,t){if(w[v]&&(r[u]||(r[u]={context:this,instance:new w[v]}),r[u].instance[x]))return r[u].instance[x].apply(this,t)},removeInstance:function(u){delete r[u]},removeAllInstances:function(){var u=
this;m.each(r,function(v,x){"function"===m.typeOf(v.instance.destroy)&&v.instance.destroy.call(v.context);u.removeInstance(x)})}}}();m.extend(this,{initialized:!1,uid:n,type:d,mode:a.getMode(p,g.required_caps,h),shimid:n+"_container",clients:0,options:g,can:function(r,u,v){v=v||k;"string"===m.typeOf(r)&&"undefined"===m.typeOf(u)&&(r=a.parseCaps(r));if("object"===m.typeOf(r)){for(var x in r)if(!this.can(x,r[x],v))return!1;return!0}return"function"===m.typeOf(v[r])?v[r].call(this,u):u===v[r]},getShimContainer:function(){var r=
f.get(this.shimid);if(!r){var u=this.options.container?f.get(this.options.container):document.body;r=document.createElement("div");r.id=this.shimid;r.className="moxie-shim moxie-shim-"+this.type;m.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});u.appendChild(r)}return r},getShim:function(){return w},shimExec:function(r,u){var v=[].slice.call(arguments,2);return q.getShim().exec.call(this,this.uid,r,u,v)},exec:function(r,u){var v=[].slice.call(arguments,
2);return q[r]&&q[r][u]?q[r][u].apply(this,v):q.shimExec.apply(this,arguments)},destroy:function(){if(q){var r=f.get(this.shimid);r&&r.parentNode.removeChild(r);w&&w.removeAllInstances();this.unbindAll();delete b[this.uid];n=q=w=this.uid=null}}});this.mode&&g.required_caps&&!this.can(g.required_caps)&&(this.mode=!1)}var e={},b={};a.order="html5,flash,silverlight,html4";a.getRuntime=function(g){return b[g]?b[g]:!1};a.addConstructor=function(g,d){d.prototype=c.instance;e[g]=d};a.getConstructor=function(g){return e[g]||
null};a.getInfo=function(g){var d=a.getRuntime(g);return d?{uid:d.uid,type:d.type,mode:d.mode,can:function(){return d.can.apply(d,arguments)}}:null};a.parseCaps=function(g){var d={};if("string"!==m.typeOf(g))return g||{};m.each(g.split(","),function(k){d[k]=!0});return d};a.can=function(g,d){return(g=a.getConstructor(g))?(d=new g({required_caps:d}),g=d.mode,d.destroy(),!!g):!1};a.thatCan=function(g,d){d=(d||a.order).split(/\s*,\s*/);for(var k in d)if(a.can(d[k],g))return d[k];return null};a.getMode=
function(g,d,k){var p=null;"undefined"===m.typeOf(k)&&(k="browser");if(d&&!m.isEmptyObj(g)){m.each(d,function(h,q){if(g.hasOwnProperty(q)){var n=g[q](h);"string"===typeof n&&(n=[n]);if(!p)p=n;else if(!(p=m.arrayIntersect(p,n)))return MXI_DEBUG&&l.debug.runtime&&l.log("\t\t%c: %v (conflicting mode requested: %s)",q,h,n),p=!1}MXI_DEBUG&&l.debug.runtime&&l.log("\t\t%c: %v (compatible modes: %s)",q,h,p)});if(p)return-1!==m.inArray(k,p)?k:p[0];if(!1===p)return!1}return k};a.capTrue=function(){return!0};
a.capFalse=function(){return!1};a.capTest=function(g){return function(){return!!g}};return a});C("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(l,m,f,c){return function(){var a;f.extend(this,{connectRuntime:function(e){function b(k){var p;if(k.length){var h=k.shift().toLowerCase();(p=c.getConstructor(h))?(MXI_DEBUG&&l.debug.runtime&&(l.log("Trying runtime: %s",h),l.log(e)),a=new p(e),a.bind("Init",function(){a.initialized=
!0;MXI_DEBUG&&l.debug.runtime&&l.log("Runtime '%s' initialized",a.type);setTimeout(function(){a.clients++;g.trigger("RuntimeInit",a)},1)}),a.bind("Error",function(){MXI_DEBUG&&l.debug.runtime&&l.log("Runtime '%s' failed to initialize",a.type);a.destroy();b(k)}),MXI_DEBUG&&l.debug.runtime&&l.log("\tselected mode: %s",a.mode),a.mode?a.init():a.trigger("Error")):b(k)}else g.trigger("RuntimeError",new m.RuntimeError(m.RuntimeError.NOT_INIT_ERR)),a=null}var g=this;if("string"===f.typeOf(e))var d=e;else"string"===
f.typeOf(e.ruid)&&(d=e.ruid);if(d){if(a=c.getRuntime(d))return a.clients++,a;throw new m.RuntimeError(m.RuntimeError.NOT_INIT_ERR);}b((e.runtime_order||c.order).split(/\s*,\s*/))},disconnectRuntime:function(){a&&0>=--a.clients&&a.destroy();a=null},getRuntime:function(){return a&&a.uid?a:a=null},exec:function(){return a?a.exec.apply(this,arguments):null}})}});C("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Env moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),
function(l,m,f,c,a,e,b,g,d){function k(h){MXI_DEBUG&&m.log("Instantiating FileInput...");var q=this;-1!==l.inArray(l.typeOf(h),["string","node"])&&(h={browse_button:h});var n=c.get(h.browse_button);if(!n)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);n={accept:[{title:b.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:n.parentNode||document.body};h=l.extend({},n,h);"string"===typeof h.required_caps&&(h.required_caps=g.parseCaps(h.required_caps));"string"===
typeof h.accept&&(h.accept=f.mimes2extList(h.accept));n=c.get(h.container);n||(n=document.body);"static"===c.getStyle(n,"position")&&(n.style.position="relative");n=n=null;d.call(q);l.extend(q,{uid:l.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){q.bind("RuntimeInit",function(w,r){q.ruid=r.uid;q.shimid=r.shimid;q.bind("Ready",function(){q.trigger("Refresh")},999);q.bind("Refresh",function(){var u=c.get(h.browse_button);var v=c.get(r.shimid);if(u){var x=c.getPos(u,c.get(h.container));
u=c.getSize(u);v&&l.extend(v.style,{top:x.y+"px",left:x.x+"px",width:u.w+"px",height:u.h+"px"})}});r.exec.call(q,"FileInput","init",h)});q.connectRuntime(l.extend({},h,{required_caps:{select_file:!0}}))},disable:function(w){var r=this.getRuntime();r&&r.exec.call(this,"FileInput","disable","undefined"===l.typeOf(w)?!0:w)},refresh:function(){q.trigger("Refresh")},destroy:function(){var w=this.getRuntime();w&&(w.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===l.typeOf(this.files)&&
l.each(this.files,function(r){r.destroy()});this.files=null;this.unbindAll()}});this.handleEventProps(p)}var p="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");k.prototype=e.instance;return k});C("moxie/core/utils/Encode",[],function(){var l=function(f){return unescape(encodeURIComponent(f))},m=function(f){return decodeURIComponent(escape(f))};return{utf8_encode:l,utf8_decode:m,atob:function(f,c){if("function"===typeof window.atob)return c?m(window.atob(f)):window.atob(f);
var a=0,e=0,b=[];if(!f)return f;f+="";do{var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++));var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++));var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++));var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++));var h=g<<18|d<<12|k<<6|p;g=h>>16&255;d=h>>8&255;h&=255;64==k?b[e++]=String.fromCharCode(g):
64==p?b[e++]=String.fromCharCode(g,d):b[e++]=String.fromCharCode(g,d,h)}while(a<f.length);f=b.join("");return c?m(f):f},btoa:function(f,c){c&&(f=l(f));if("function"===typeof window.btoa)return window.btoa(f);var a=c=0,e=[];if(!f)return f;do{var b=f.charCodeAt(c++);var g=f.charCodeAt(c++);var d=f.charCodeAt(c++);var k=b<<16|g<<8|d;b=k>>18&63;g=k>>12&63;d=k>>6&63;k&=63;e[a++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)}while(c<f.length);c=e.join("");f=f.length%3;return(f?c.slice(0,f-3):c)+"===".slice(f||3)}}});C("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(l,m,f){function c(e,b){function g(d,k,p){var h=a[this.uid];if("string"!==l.typeOf(h)||!h.length)return null;k=new c(null,{type:p,size:k-d});
k.detach(h.substr(d,k.size));return k}f.call(this);e&&this.connectRuntime(e);b?"string"===l.typeOf(b)&&(b={data:b}):b={};l.extend(this,{uid:b.uid||l.guid("uid_"),ruid:e,size:b.size||0,type:b.type||"",slice:function(d,k,p){return this.isDetached()?g.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),d,k,p)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(d){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),
this.ruid=null);d=d||"";if("data:"==d.substr(0,5)){var k=d.indexOf(";base64,");this.type=d.substring(5,k);d=m.atob(d.substring(k+8))}this.size=d.length;a[this.uid]=d},isDetached:function(){return!this.ruid&&"string"===l.typeOf(a[this.uid])},destroy:function(){this.detach();delete a[this.uid]}});b.data?this.detach(b.data):a[this.uid]=b}var a={};return c});C("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(l,m,f){function c(a,e){e||(e={});f.apply(this,
arguments);this.type||(this.type=m.getFileMime(e.name));if(e.name){var b=e.name.replace(/\\/g,"/");b=b.substr(b.lastIndexOf("/")+1)}else this.type&&(b=this.type.split("/")[0],b=l.guid((""!==b?b:"file")+"_"),m.extensions[this.type]&&(b+="."+m.extensions[this.type][0]));l.extend(this,{name:b||l.guid("file_"),relativePath:"",lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString()})}c.prototype=f.prototype;return c});C("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/core/utils/Env moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),
function(l,m,f,c,a,e,b,g,d){function k(h){MXI_DEBUG&&a.log("Instantiating FileDrop...");var q=this;"string"===typeof h&&(h={drop_zone:h});var n={accept:[{title:l.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};h="object"===typeof h?c.extend({},n,h):n;h.container=m.get(h.drop_zone)||document.body;"static"===m.getStyle(h.container,"position")&&(h.container.style.position="relative");"string"===typeof h.accept&&(h.accept=d.mimes2extList(h.accept));b.call(q);c.extend(q,{uid:c.guid("uid_"),
ruid:null,files:null,init:function(){q.bind("RuntimeInit",function(w,r){q.ruid=r.uid;r.exec.call(q,"FileDrop","init",h);q.dispatchEvent("ready")});q.connectRuntime(h)},destroy:function(){var w=this.getRuntime();w&&(w.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null;this.unbindAll()}});this.handleEventProps(p)}var p=["ready","dragenter","dragleave","drop","error"];k.prototype=g.instance;return k});C("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/runtime/RuntimeClient".split(" "),
function(l,m,f,c,a,e){function b(){function d(k,p){this.trigger("loadstart");if(this.readyState===b.LOADING)this.trigger("error",new f.DOMException(f.DOMException.INVALID_STATE_ERR)),this.trigger("loadend");else if(p instanceof a)if(this.result=null,this.readyState=b.LOADING,p.isDetached()){var h=p.getSource();switch(k){case "readAsText":case "readAsBinaryString":this.result=h;break;case "readAsDataURL":this.result="data:"+p.type+";base64,"+m.btoa(h)}this.readyState=b.DONE;this.trigger("load");this.trigger("loadend")}else this.connectRuntime(p.ruid),
this.exec("FileReader","read",k,p);else this.trigger("error",new f.DOMException(f.DOMException.NOT_FOUND_ERR)),this.trigger("loadend")}e.call(this);l.extend(this,{uid:l.guid("uid_"),readyState:b.EMPTY,result:null,error:null,readAsBinaryString:function(k){d.call(this,"readAsBinaryString",k)},readAsDataURL:function(k){d.call(this,"readAsDataURL",k)},readAsText:function(k){d.call(this,"readAsText",k)},abort:function(){this.result=null;-1===l.inArray(this.readyState,[b.EMPTY,b.DONE])&&(this.readyState===
b.LOADING&&(this.readyState=b.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(g);this.bind("Error",function(k,p){this.readyState=b.DONE;this.error=p},999);this.bind("Load",function(k){this.readyState=b.DONE},999)}var g="loadstart progress load abort error loadend".split(" ");b.EMPTY=0;b.LOADING=1;b.DONE=2;b.prototype=c.instance;
return b});C("moxie/core/utils/Url",[],function(){var l=function(m,f){var c="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),a=c.length,e={http:80,https:443},b={};for(m=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(m||"");a--;)m[a]&&(b[c[a]]=m[a]);b.scheme||(f&&"string"!==typeof f||(f=l(f||document.location.href)),b.scheme=
f.scheme,b.host=f.host,b.port=f.port,c="",/^[^\/]/.test(b.path)&&(c=f.path,c=/\/[^\/]*\.[^\/]*$/.test(c)?c.replace(/\/[^\/]+$/,"/"):c.replace(/\/?$/,"/")),b.path=c+(b.path||""));b.port||(b.port=e[b.scheme]||80);b.port=parseInt(b.port,10);b.path||(b.path="/");delete b.source;return b};return{parseUrl:l,resolveUrl:function(m){m="object"===typeof m?m:l(m);return m.scheme+"://"+m.host+(m.port!=={http:80,https:443}[m.scheme]?":"+m.port:"")+m.path+(m.query?m.query:"")},hasSameOrigin:function(m){function f(c){return[c.scheme,
c.host,c.port].join("/")}"string"===typeof m&&(m=l(m));return f(l())===f(m)}}});C("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(l,m,f){function c(){this.uid=l.guid("uid_");m.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}c.prototype=f.instance;return c});C("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(l,m,f){return function(){function c(a,
e){if(e.isDetached()){var b=e.getSource();switch(a){case "readAsBinaryString":return b;case "readAsDataURL":return"data:"+e.type+";base64,"+f.btoa(b);case "readAsText":a="";e=0;for(var g=b.length;e<g;e++)a+=String.fromCharCode(b[e]);return a}}else return b=this.connectRuntime(e.ruid).exec.call(this,"FileReaderSync","read",a,e),this.disconnectRuntime(),b}m.call(this);l.extend(this,{uid:l.guid("uid_"),readAsBinaryString:function(a){return c.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return c.call(this,
"readAsDataURL",a)},readAsText:function(a){return c.call(this,"readAsText",a)}})}});C("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(l,m,f){return function(){var c,a=[];m.extend(this,{append:function(e,b){var g=this,d=m.typeOf(b);b instanceof f?c={name:e,value:b}:"array"===d?(e+="[]",m.each(b,function(k){g.append(e,k)})):"object"===d?m.each(b,function(k,p){g.append(e+"["+p+"]",k)}):"null"===d||"undefined"===d||"number"===d&&isNaN(b)?g.append(e,"false"):
a.push({name:e,value:b.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return c&&c.value||null},getBlobName:function(){return c&&c.name||null},each:function(e){m.each(a,function(b){e(b.value,b.name)});c&&e(c.value,c.name)},destroy:function(){c=null;a=[]}})}});C("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),
function(l,m,f,c,a,e,b,g,d,k,p,h){function q(){this.uid=l.guid("uid_")}function n(){function u(D,H){if(t.hasOwnProperty(D)){if(1===arguments.length)return p.can("define_property")?t[D]:x[D];p.can("define_property")?t[D]=H:x[D]=H}}function v(D){function H(){J&&(J.destroy(),J=null);K.dispatchEvent("loadend");K=null}function Y(U){J.bind("LoadStart",function(M){u("readyState",n.LOADING);K.dispatchEvent("readystatechange");K.dispatchEvent(M);S&&K.upload.dispatchEvent(M)});J.bind("Progress",function(M){u("readyState")!==
n.LOADING&&(u("readyState",n.LOADING),K.dispatchEvent("readystatechange"));K.dispatchEvent(M)});J.bind("UploadProgress",function(M){S&&K.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:M.total,loaded:M.loaded})});J.bind("Load",function(M){u("readyState",n.DONE);u("status",Number(U.exec.call(J,"XMLHttpRequest","getStatus")||0));u("statusText",w[u("status")]||"");u("response",U.exec.call(J,"XMLHttpRequest","getResponse",u("responseType")));~l.inArray(u("responseType"),["text",""])?u("responseText",
u("response")):"document"===u("responseType")&&u("responseXML",u("response"));X=U.exec.call(J,"XMLHttpRequest","getAllResponseHeaders");K.dispatchEvent("readystatechange");0<u("status")?(S&&K.upload.dispatchEvent(M),K.dispatchEvent(M)):(P=!0,K.dispatchEvent("error"));H()});J.bind("Abort",function(M){K.dispatchEvent(M);H()});J.bind("Error",function(M){P=!0;u("readyState",n.DONE);K.dispatchEvent("readystatechange");N=!0;K.dispatchEvent(M);H()});U.exec.call(J,"XMLHttpRequest","send",{url:B,method:z,
async:y,user:A,password:F,headers:E,mimeType:I,encoding:G,responseType:K.responseType,withCredentials:K.withCredentials,options:O},D)}var K=this;(new Date).getTime();J=new b;"string"===typeof O.required_caps&&(O.required_caps=e.parseCaps(O.required_caps));O.required_caps=l.extend({},O.required_caps,{return_response_type:K.responseType});D instanceof k&&(O.required_caps.send_multipart=!0);l.isEmptyObj(E)||(O.required_caps.send_custom_headers=!0);Z||(O.required_caps.do_cors=!0);O.ruid?Y(J.connectRuntime(O)):
(J.bind("RuntimeInit",function(U,M){Y(M)}),J.bind("RuntimeError",function(U,M){K.dispatchEvent("RuntimeError",M)}),J.connectRuntime(O))}var x=this,t={timeout:0,readyState:n.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},y=!0,B,z,E={},A,F,G=null,I=null,L=!1,T=!1,S=!1,N=!1,P=!1,Z=!1,O={},J,X="",W;l.extend(this,t,{uid:l.guid("uid_"),upload:new q,open:function(D,H,Y,K,U){if(!D||!H)throw new m.DOMException(m.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(D)||
c.utf8_encode(D)!==D)throw new m.DOMException(m.DOMException.SYNTAX_ERR);~l.inArray(D.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(z=D.toUpperCase());if(~l.inArray(z,["CONNECT","TRACE","TRACK"]))throw new m.DOMException(m.DOMException.SECURITY_ERR);H=c.utf8_encode(H);D=a.parseUrl(H);Z=a.hasSameOrigin(D);B=a.resolveUrl(H);if((K||U)&&!Z)throw new m.DOMException(m.DOMException.INVALID_ACCESS_ERR);A=K||D.user;F=U||D.pass;y=Y||!0;if(!1===y&&(u("timeout")||u("withCredentials")||
""!==u("responseType")))throw new m.DOMException(m.DOMException.INVALID_ACCESS_ERR);L=!y;T=!1;E={};u("responseText","");u("responseXML",null);u("response",null);u("status",0);u("statusText","");u("readyState",n.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(D,H){if(u("readyState")!==n.OPENED||T)throw new m.DOMException(m.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(D)||c.utf8_encode(D)!==D)throw new m.DOMException(m.DOMException.SYNTAX_ERR);D=l.trim(D).toLowerCase();
if(~l.inArray(D,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(D))return!1;E[D]=E[D]?E[D]+(", "+H):H;return!0},getAllResponseHeaders:function(){return X||""},getResponseHeader:function(D){D=D.toLowerCase();return P||~l.inArray(D,["set-cookie","set-cookie2"])?
null:X&&""!==X&&(W||(W={},l.each(X.split(/\r\n/),function(H){H=H.split(/:\s+/);2===H.length&&(H[0]=l.trim(H[0]),W[H[0].toLowerCase()]={header:H[0],value:l.trim(H[1])})})),W.hasOwnProperty(D))?W[D].header+": "+W[D].value:null},overrideMimeType:function(D){var H;if(~l.inArray(u("readyState"),[n.LOADING,n.DONE]))throw new m.DOMException(m.DOMException.INVALID_STATE_ERR);D=l.trim(D.toLowerCase());/;/.test(D)&&(H=D.match(/^([^;]+)(?:;\scharset=)?(.*)$/))&&(D=H[1]);if(!h.mimes[D])throw new m.DOMException(m.DOMException.SYNTAX_ERR);
},send:function(D,H){O="string"===l.typeOf(H)?{ruid:H}:H?H:{};if(this.readyState!==n.OPENED||T)throw new m.DOMException(m.DOMException.INVALID_STATE_ERR);D instanceof g?(O.ruid=D.ruid,I=D.type||"application/octet-stream"):D instanceof k?D.hasBlob()&&(H=D.getBlob(),O.ruid=H.ruid,I=H.type||"application/octet-stream"):"string"===typeof D&&(G="UTF-8",I="text/plain;charset=UTF-8",D=c.utf8_encode(D));this.withCredentials||(this.withCredentials=O.required_caps&&O.required_caps.send_browser_cookies&&!Z);
S=!L&&this.upload.hasEventListener();P=!1;N=!D;L||(T=!0);v.call(this,D)},abort:function(){P=!0;L=!1;if(~l.inArray(u("readyState"),[n.UNSENT,n.OPENED,n.DONE]))u("readyState",n.UNSENT);else{u("readyState",n.DONE);T=!1;if(J)J.getRuntime().exec.call(J,"XMLHttpRequest","abort",N);else throw new m.DOMException(m.DOMException.INVALID_STATE_ERR);N=!0}},destroy:function(){J&&("function"===l.typeOf(J.destroy)&&J.destroy(),J=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}});this.handleEventProps(r.concat(["readystatechange"]));
this.upload.handleEventProps(r)}var w={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",
405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",
504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};q.prototype=f.instance;var r="loadstart progress abort error load timeout loadend".split(" ");n.UNSENT=0;n.OPENED=1;n.HEADERS_RECEIVED=2;n.LOADING=3;n.DONE=4;n.prototype=f.instance;return n});C("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(l,m,f,c){function a(){function e(n,
w){var r=this;d=w;r.bind("TransportingProgress",function(u){h=u.loaded;h<p&&-1===l.inArray(r.state,[a.IDLE,a.DONE])&&b.call(r)},999);r.bind("TransportingComplete",function(){h=p;r.state=a.DONE;k=null;r.result=d.exec.call(r,"Transporter","getAsBlob",n||"")},999);r.state=a.BUSY;r.trigger("TransportingStarted");b.call(r)}function b(){var n=p-h;q>n&&(q=n);n=m.btoa(k.substr(h,q));d.exec.call(this,"Transporter","receive",n,p)}var g,d,k,p,h,q;f.call(this);l.extend(this,{uid:l.guid("uid_"),state:a.IDLE,result:null,
transport:function(n,w,r){var u=this;r=l.extend({chunk_size:204798},r);if(g=r.chunk_size%3)r.chunk_size+=3-g;q=r.chunk_size;p=h=0;k=this.result=null;k=n;p=n.length;if("string"===l.typeOf(r)||r.ruid)e.call(u,w,this.connectRuntime(r));else{var v=function(x,t){u.unbind("RuntimeInit",v);e.call(u,w,t)};this.bind("RuntimeInit",v);this.connectRuntime(r)}},abort:function(){this.state=a.IDLE;d&&(d.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));p=h=0;k=this.result=null},destroy:function(){this.unbindAll();
d=null;this.disconnectRuntime();p=h=0;k=this.result=null}})}a.IDLE=0;a.BUSY=1;a.DONE=2;a.prototype=c.instance;return a});C("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),function(l,m,f,c,a,e,b,g,d,k,p,h,q){function n(){function r(t){var y=
l.typeOf(t);try{if(t instanceof n){if(!t.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);u.apply(this,arguments)}else if(t instanceof p){if(!~l.inArray(t.type,["image/jpeg","image/png"]))throw new f.ImageError(f.ImageError.WRONG_FORMAT);v.apply(this,arguments)}else if(-1!==l.inArray(y,["blob","file"]))r.call(this,new h(null,t),arguments[1]);else if("string"===y)"data:"===t.substr(0,5)?r.call(this,new p(null,{data:t}),arguments[1]):x.apply(this,arguments);else if("node"===y&&"img"===
t.nodeName.toLowerCase())r.call(this,t.src,arguments[1]);else throw new f.DOMException(f.DOMException.TYPE_MISMATCH_ERR);}catch(B){this.trigger("error",B.code)}}function u(t,y){var B=this.connectRuntime(t.ruid);this.ruid=B.uid;B.exec.call(this,"Image","loadFromImage",t,"undefined"===l.typeOf(y)?!0:y)}function v(t,y){function B(E){z.ruid=E.uid;E.exec.call(z,"Image","loadFromBlob",t)}var z=this;z.name=t.name||"";t.isDetached()?(this.bind("RuntimeInit",function(E,A){B(A)}),y&&"string"===typeof y.required_caps&&
(y.required_caps=e.parseCaps(y.required_caps)),this.connectRuntime(l.extend({required_caps:{access_image_binary:!0,resize_image:!0}},y))):B(this.connectRuntime(t.ruid))}function x(t,y){var B=this;var z=new a;z.open("get",t);z.responseType="blob";z.onprogress=function(E){B.trigger(E)};z.onload=function(){v.call(B,z.response,!0)};z.onerror=function(E){B.trigger(E)};z.onloadend=function(){z.destroy()};z.bind("RuntimeError",function(E,A){B.trigger("RuntimeError",A)});z.send(null,y)}b.call(this);l.extend(this,
{uid:l.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){r.apply(this,arguments)},downsize:function(t,y,B,z){var E={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};t="object"===typeof t?l.extend(E,t):l.extend(E,{width:t,height:y,crop:B,preserveHeaders:z});try{if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);if(this.width>
n.MAX_RESIZE_WIDTH||this.height>n.MAX_RESIZE_HEIGHT)throw new f.ImageError(f.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(A){this.trigger("error",A.code)}},crop:function(t,y,B){this.downsize(t,y,!0,B)},getAsCanvas:function(){if(!d.can("create_canvas"))throw new f.RuntimeError(f.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(t,y){if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);
return this.exec("Image","getAsBlob",t||"image/jpeg",y||90)},getAsDataURL:function(t,y){if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",t||"image/jpeg",y||90)},getAsBinaryString:function(t,y){t=this.getAsDataURL(t,y);return q.atob(t.substring(t.indexOf("base64,")+7))},embed:function(t,y){function B(F,G){var I=this;if(d.can("create_canvas")){var L=I.getAsCanvas();if(L){t.appendChild(L);L=null;I.destroy();z.trigger("embedded");return}}G=
I.getAsDataURL(F,G);if(!G)throw new f.ImageError(f.ImageError.WRONG_FORMAT);d.can("use_data_uri_of",G.length)?(t.innerHTML='<img src="'+G+'" width="'+I.width+'" height="'+I.height+'" />',I.destroy(),z.trigger("embedded")):(L=new g,L.bind("TransportingComplete",function(){E=z.connectRuntime(this.result.ruid);z.bind("Embedded",function(){l.extend(E.getShimContainer().style,{top:"0px",left:"0px",width:I.width+"px",height:I.height+"px"});E=null},999);E.exec.call(z,"ImageView","display",this.result.uid,
width,height);I.destroy()}),L.transport(q.atob(G.substring(G.indexOf("base64,")+7)),F,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:t}))}var z=this,E;y=l.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},y||{});try{if(!(t=m.get(t)))throw new f.DOMException(f.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);var A=new n;A.bind("Resize",function(){B.call(this,y.type,y.quality)});
A.bind("Load",function(){A.downsize(y)});this.meta.thumb&&this.meta.thumb.width>=y.width&&this.meta.thumb.height>=y.height?A.load(this.meta.thumb.data):A.clone(this,!1);return A}catch(F){this.trigger("error",F.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}});this.handleEventProps(w);this.bind("Load Resize",function(){var t=this.exec("Image","getInfo");this.size=t.size;this.width=t.width;this.height=t.height;this.type=
t.type;this.meta=t.meta;""===this.name&&(this.name=t.name)},999)}var w=["progress","load","error","resize","embedded"];n.MAX_RESIZE_WIDTH=8192;n.MAX_RESIZE_HEIGHT=8192;n.prototype=k.instance;return n});C("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(l,m,f,c){var a={};f.addConstructor("html5",function(e,b,g){var d=this,k=f.capTest,p=f.capTrue;g=l.extend({access_binary:k(window.FileReader||window.File&&window.File.getAsDataURL),
access_image_binary:function(){return d.can("access_binary")&&!!a.Image},display_media:k(c.can("create_canvas")||c.can("use_data_uri_over32kb")),do_cors:k(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:k(function(){var h=document.createElement("div");return("draggable"in h||"ondragstart"in h&&"ondrop"in h)&&("IE"!==c.browser||c.verComp(c.version,9,">"))}()),filter_by_extension:k("Chrome"===c.browser&&c.verComp(c.version,28,">=")||"IE"===c.browser&&c.verComp(c.version,
10,">=")||"Safari"===c.browser&&c.verComp(c.version,7,">=")),return_response_headers:p,return_response_type:function(h){return"json"===h&&window.JSON?!0:c.can("return_response_type",h)},return_status_code:p,report_upload_progress:k(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return d.can("access_binary")&&c.can("create_canvas")},select_file:function(){return c.can("use_fileinput")&&window.File},select_folder:function(){return d.can("select_file")&&"Chrome"===c.browser&&
c.verComp(c.version,21,">=")},select_multiple:function(){return d.can("select_file")&&!("Safari"===c.browser&&"Windows"===c.os)&&!("iOS"===c.os&&c.verComp(c.osVersion,"7.0.0",">")&&c.verComp(c.osVersion,"8.0.0","<"))},send_binary_string:k(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:k(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||d.can("send_binary_string")},
slice_blob:k(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return d.can("slice_blob")&&d.can("send_multipart")},summon_file_dialog:function(){return d.can("select_file")&&("Firefox"===c.browser&&c.verComp(c.version,4,">=")||"Opera"===c.browser&&c.verComp(c.version,12,">=")||"IE"===c.browser&&c.verComp(c.version,10,">=")||!!~l.inArray(c.browser,["Chrome","Safari"]))},upload_filesize:p},g);f.call(this,e,b||"html5",g);l.extend(this,
{init:function(){this.trigger("Init")},destroy:function(h){return function(){h.call(d);h=d=null}}(this.destroy)});l.extend(this.getShim(),a)});return a});C("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(l){function m(){this.returnValue=!1}function f(){this.cancelBubble=!0}var c={},a="moxie_"+l.guid(),e=function(b,g,d){g=g.toLowerCase();if(b[a]&&c[b[a]]&&c[b[a]][g]){var k=c[b[a]][g];for(var p=k.length-1;0<=p;p--)if(k[p].orig===d||k[p].key===d)if(b.removeEventListener?b.removeEventListener(g,
k[p].func,!1):b.detachEvent&&b.detachEvent("on"+g,k[p].func),k[p].orig=null,k[p].func=null,k.splice(p,1),void 0!==d)break;k.length||delete c[b[a]][g];if(l.isEmptyObj(c[b[a]])){delete c[b[a]];try{delete b[a]}catch(h){b[a]=void 0}}}};return{addEvent:function(b,g,d,k){g=g.toLowerCase();if(b.addEventListener){var p=d;b.addEventListener(g,p,!1)}else b.attachEvent&&(p=function(){var h=window.event;h.target||(h.target=h.srcElement);h.preventDefault=m;h.stopPropagation=f;d(h)},b.attachEvent("on"+g,p));b[a]||
(b[a]=l.guid());c.hasOwnProperty(b[a])||(c[b[a]]={});b=c[b[a]];b.hasOwnProperty(g)||(b[g]=[]);b[g].push({func:p,orig:d,key:k})},removeEvent:e,removeAllEvents:function(b,g){b&&b[a]&&l.each(c[b[a]],function(d,k){e(b,k,g)})}}});C("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(l,m,f,c,a,e,b){return l.FileInput=function(){var g;f.extend(this,
{init:function(d){var k=this,p=k.getRuntime();g=d;d=g.accept.mimes||e.extList2mimes(g.accept,p.can("filter_by_extension"));var h=p.getShimContainer();h.innerHTML='<input id="'+p.uid+'" type="file" style="font-size:999px;opacity:0;"'+(g.multiple&&p.can("select_multiple")?"multiple":"")+(g.directory&&p.can("select_folder")?"webkitdirectory directory":"")+(d?' accept="'+d.join(",")+'"':"")+" />";d=c.get(p.uid);f.extend(d.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});var q=c.get(g.browse_button);
if(p.can("summon_file_dialog")){"static"===c.getStyle(q,"position")&&(q.style.position="relative");var n=parseInt(c.getStyle(q,"z-index"),10)||1;q.style.zIndex=n;h.style.zIndex=n-1;a.addEvent(q,"click",function(w){var r=c.get(p.uid);r&&!r.disabled&&r.click();w.preventDefault()},k.uid)}h=p.can("summon_file_dialog")?q:h;a.addEvent(h,"mouseover",function(){k.trigger("mouseenter")},k.uid);a.addEvent(h,"mouseout",function(){k.trigger("mouseleave")},k.uid);a.addEvent(h,"mousedown",function(){k.trigger("mousedown")},
k.uid);a.addEvent(c.get(g.container),"mouseup",function(){k.trigger("mouseup")},k.uid);d.onchange=function u(r){k.files=[];f.each(this.files,function(v){var x="";if(g.directory&&"."==v.name)return!0;v.webkitRelativePath&&(x="/"+v.webkitRelativePath.replace(/^\//,""));v=new m(p.uid,v);v.relativePath=x;k.files.push(v)});"IE"!==b.browser&&"IEMobile"!==b.browser?this.value="":(r=this.cloneNode(!0),this.parentNode.replaceChild(r,this),r.onchange=u);k.files.length&&k.trigger("change")};k.trigger({type:"ready",
async:!0});h=null},disable:function(d){var k=this.getRuntime();if(k=c.get(k.uid))k.disabled=!!d},destroy:function(){var d=this.getRuntime(),k=d.getShim();d=d.getShimContainer();a.removeAllEvents(d,this.uid);a.removeAllEvents(g&&c.get(g.container),this.uid);a.removeAllEvents(g&&c.get(g.browse_button),this.uid);d&&(d.innerHTML="");k.removeInstance(this.uid);g=null}})}});C("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(l,m){return l.Blob=function(){function f(c,
a,e){var b;if(window.File.prototype.slice)try{return c.slice(),c.slice(a,e)}catch(g){return c.slice(a,e-a)}else return(b=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?b.call(c,a,e):null}this.slice=function(){return new m(this.getRuntime().uid,f.apply(this,arguments))}}});C("moxie/runtime/html5/file/FileDrop","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime".split(" "),function(l,m,f,c,a,e){return l.FileDrop=
function(){function b(v){if(!v.dataTransfer||!v.dataTransfer.types)return!1;v=f.toArray(v.dataTransfer.types||[]);return-1!==f.inArray("Files",v)||-1!==f.inArray("public.file-url",v)||-1!==f.inArray("application/x-moz-file",v)}function g(v,x){if(w.length){var t=e.getFileExtension(v.name);t=!t||-1!==f.inArray(t,w)}else t=!0;t&&(v=new m(u,v),v.relativePath=x||"",n.push(v))}function d(v){for(var x=[],t=0;t<v.length;t++)[].push.apply(x,v[t].extensions.split(/\s*,\s*/));return-1===f.inArray("*",x)?x:[]}
function k(v,x){var t=[];f.each(v,function(y){var B=y.webkitGetAsEntry();B&&(B.isFile?g(y.getAsFile(),B.fullPath):t.push(B))});t.length?p(t,x):x()}function p(v,x){var t=[];f.each(v,function(y){t.push(function(B){h(y,B)})});f.inSeries(t,function(){x()})}function h(v,x){v.isFile?v.file(function(t){g(t,v.fullPath);x()},function(){x()}):v.isDirectory?q(v,x):x()}function q(v,x){function t(z){B.readEntries(function(E){E.length?([].push.apply(y,E),t(z)):z()},z)}var y=[],B=v.createReader();t(function(){p(y,
x)})}var n=[],w=[],r,u;f.extend(this,{init:function(v){var x=this;r=v;u=x.ruid;w=d(r.accept);v=r.container;a.addEvent(v,"dragover",function(t){b(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")},x.uid);a.addEvent(v,"drop",function(t){b(t)&&(t.preventDefault(),n=[],t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry?k(t.dataTransfer.items,function(){x.files=n;x.trigger("drop")}):(f.each(t.dataTransfer.files,function(y){g(y)}),x.files=n,x.trigger("drop")))},x.uid);a.addEvent(v,"dragenter",
function(t){x.trigger("dragenter")},x.uid);a.addEvent(v,"dragleave",function(t){x.trigger("dragleave")},x.uid)},destroy:function(){a.removeAllEvents(r&&c.get(r.container),this.uid);u=n=w=r=null}})}});C("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(l,m,f){return l.FileReader=function(){var c,a=!1;f.extend(this,{read:function(e,b){var g=this;g.result="";c=new window.FileReader;c.addEventListener("progress",function(d){g.trigger(d)});
c.addEventListener("load",function(d){if(a){var k=c.result;k=m.atob(k.substring(k.indexOf("base64,")+7))}else k=c.result;g.result=k;g.trigger(d)});c.addEventListener("error",function(d){g.trigger(d,c.error)});c.addEventListener("loadend",function(d){c=null;g.trigger(d)});"function"===f.typeOf(c[e])?(a=!1,c[e](b.getSource())):"readAsBinaryString"===e&&(a=!0,c.readAsDataURL(b.getSource()))},abort:function(){c&&c.abort()},destroy:function(){c=null}})}});C("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),
function(l,m,f,c,a,e,b,g,d){return l.XMLHttpRequest=function(){function k(r,u){var v=this;var x=u.getBlob().getSource();var t=new window.FileReader;t.onload=function(){u.append(u.getBlobName(),new e(null,{type:x.type,data:t.result}));q.send.call(v,r,u)};t.readAsBinaryString(x)}function p(){if(!window.XMLHttpRequest||"IE"===d.browser&&d.verComp(d.version,8,"<")){a:{for(var r=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],u=0;u<r.length;u++)try{var v=new ActiveXObject(r[u]);break a}catch(x){}v=void 0}return v}return new window.XMLHttpRequest}
function h(r){var u="----moxieboundary"+(new Date).getTime(),v="";if(!this.getRuntime().can("send_binary_string"))throw new g.RuntimeError(g.RuntimeError.NOT_SUPPORTED_ERR);n.setRequestHeader("Content-Type","multipart/form-data; boundary="+u);r.each(function(x,t){v=x instanceof e?v+("--"+u+'\r\nContent-Disposition: form-data; name="'+t+'"; filename="'+unescape(encodeURIComponent(x.name||"blob"))+'"\r\nContent-Type: '+(x.type||"application/octet-stream")+"\r\n\r\n"+x.getSource()+"\r\n"):v+("--"+u+
'\r\nContent-Disposition: form-data; name="'+t+'"\r\n\r\n'+unescape(encodeURIComponent(x))+"\r\n")});return v+="--"+u+"--\r\n"}var q=this,n,w;m.extend(this,{send:function(r,u){var v=this,x="Mozilla"===d.browser&&d.verComp(d.version,4,">=")&&d.verComp(d.version,7,"<"),t="Android Browser"===d.browser,y=!1;w=r.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();n=p();n.open(r.method,r.url,r.async,r.user,r.password);if(u instanceof e)u.isDetached()&&(y=!0),u=u.getSource();else if(u instanceof b){if(u.hasBlob())if(u.getBlob().isDetached())u=
h.call(v,u),y=!0;else if((x||t)&&"blob"===m.typeOf(u.getBlob().getSource())&&window.FileReader){k.call(v,r,u);return}if(u instanceof b){var B=new window.FormData;u.each(function(z,E){z instanceof e?B.append(E,z.getSource()):B.append(E,z)});u=B}}n.upload?(r.withCredentials&&(n.withCredentials=!0),n.addEventListener("load",function(z){v.trigger(z)}),n.addEventListener("error",function(z){v.trigger(z)}),n.addEventListener("progress",function(z){v.trigger(z)}),n.upload.addEventListener("progress",function(z){v.trigger({type:"UploadProgress",
loaded:z.loaded,total:z.total})})):n.onreadystatechange=function(){switch(n.readyState){case 3:var z;try{if(c.hasSameOrigin(r.url)&&(z=n.getResponseHeader("Content-Length")||0),n.responseText)var E=n.responseText.length}catch(A){z=E=0}v.trigger({type:"progress",lengthComputable:!!z,total:parseInt(z,10),loaded:E});break;case 4:n.onreadystatechange=function(){},0===n.status?v.trigger("error"):v.trigger("load")}};m.isEmptyObj(r.headers)||m.each(r.headers,function(z,E){n.setRequestHeader(E,z)});""!==
r.responseType&&"responseType"in n&&("json"!==r.responseType||d.can("return_response_type","json")?n.responseType=r.responseType:n.responseType="text");y?n.sendAsBinary?n.sendAsBinary(u):function(){for(var z=new Uint8Array(u.length),E=0;E<u.length;E++)z[E]=u.charCodeAt(E)&255;n.send(z.buffer)}():n.send(u);v.trigger("loadstart")},getStatus:function(){try{if(n)return n.status}catch(r){}return 0},getResponse:function(r){var u=this.getRuntime();try{switch(r){case "blob":var v=new a(u.uid,n.response),
x=n.getResponseHeader("Content-Disposition");if(x){var t=x.match(/filename=(['"'])([^\1]+)\1/);t&&(w=t[2])}v.name=w;v.type||(v.type=f.getFileMime(w));return v;case "json":return d.can("return_response_type","json")?n.response:200===n.status&&window.JSON?JSON.parse(n.responseText):null;case "document":var y=n.responseXML,B=n.responseText;"IE"===d.browser&&B&&y&&!y.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(n.getResponseHeader("Content-Type"))&&(y=new window.ActiveXObject("Microsoft.XMLDOM"),y.async=
!1,y.validateOnParse=!1,y.loadXML(B));var z=y&&("IE"===d.browser&&0!==y.parseError||!y.documentElement||"parsererror"===y.documentElement.tagName)?null:y;return z;default:return""!==n.responseText?n.responseText:null}}catch(E){return null}},getAllResponseHeaders:function(){try{return n.getAllResponseHeaders()}catch(r){}return""},abort:function(){n&&n.abort()},destroy:function(){q=w=null}})}});C("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(l){function m(a){a instanceof
ArrayBuffer?f.apply(this,arguments):c.apply(this,arguments)}function f(a){var e=new DataView(a);l.extend(this,{readByteAt:function(b){return e.getUint8(b)},writeByteAt:function(b,g){e.setUint8(b,g)},SEGMENT:function(b,g,d){switch(arguments.length){case 2:return a.slice(b,b+g);case 1:return a.slice(b);case 3:if(null===d&&(d=new ArrayBuffer),d instanceof ArrayBuffer){var k=new Uint8Array(this.length()-g+d.byteLength);0<b&&k.set(new Uint8Array(a.slice(0,b)),0);k.set(new Uint8Array(d),b);k.set(new Uint8Array(a.slice(b+
g)),b+d.byteLength);this.clear();a=k.buffer;e=new DataView(a);break}default:return a}},length:function(){return a?a.byteLength:0},clear:function(){e=a=null}})}function c(a){function e(b,g,d){d=3===arguments.length?d:a.length-g-1;a=a.substr(0,g)+b+a.substr(d+g)}l.extend(this,{readByteAt:function(b){return a.charCodeAt(b)},writeByteAt:function(b,g){e(String.fromCharCode(g),b,1)},SEGMENT:function(b,g,d){switch(arguments.length){case 1:return a.substr(b);case 2:return a.substr(b,g);case 3:e(null!==d?
d:"",b,g);break;default:return a}},length:function(){return a?a.length:0},clear:function(){a=null}})}l.extend(m.prototype,{littleEndian:!1,read:function(a,e){var b,g;if(a+e>this.length())throw Error("You are trying to read outside the source boundaries.");var d=this.littleEndian?0:-8*(e-1);for(b=g=0;g<e;g++)b|=this.readByteAt(a+g)<<Math.abs(d+8*g);return b},write:function(a,e,b){var g;if(a>this.length())throw Error("You are trying to write outside the source boundaries.");var d=this.littleEndian?
0:-8*(b-1);for(g=0;g<b;g++)this.writeByteAt(a+g,e>>Math.abs(d+8*g)&255)},BYTE:function(a){return this.read(a,1)},SHORT:function(a){return this.read(a,2)},LONG:function(a){return this.read(a,4)},SLONG:function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a},CHAR:function(a){return String.fromCharCode(this.read(a,1))},STRING:function(a,e){return this.asArray("CHAR",a,e).join("")},asArray:function(a,e,b){for(var g=[],d=0;d<b;d++)g[d]=this[a](e+d);return g}});return m});C("moxie/runtime/html5/image/JPEGHeaders",
["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(l,m){return function a(c){var e=[],b,g=0;c=new l(c);if(65496!==c.SHORT(0))throw c.clear(),new m.ImageError(m.ImageError.WRONG_FORMAT);for(b=2;b<=c.length();){var d=c.SHORT(b);if(65488<=d&&65495>=d)b+=2;else{if(65498===d||65497===d)break;g=c.SHORT(b+2)+2;65505<=d&&65519>=d&&e.push({hex:d,name:"APP"+(d&15),start:b,length:g,segment:c.SEGMENT(b,g)});b+=g}}c.clear();return{headers:e,restore:function(k){var p=new l(k);b=65504==
p.SHORT(2)?4+p.SHORT(4):2;var h=0;for(k=e.length;h<k;h++)p.SEGMENT(b,0,e[h].segment),b+=e[h].length;k=p.SEGMENT();p.clear();return k},strip:function(k){var p=new a(k);var h=p.headers;p.purge();p=new l(k);for(k=h.length;k--;)p.SEGMENT(h[k].start,h[k].length,"");k=p.SEGMENT();p.clear();return k},get:function(k){for(var p=[],h=0,q=e.length;h<q;h++)e[h].name===k.toUpperCase()&&p.push(e[h].segment);return p},set:function(k,p){var h=[],q,n;"string"===typeof p?h.push(p):h=p;p=q=0;for(n=e.length;p<n&&!(e[p].name===
k.toUpperCase()&&(e[p].segment=h[q],e[p].length=h[q].length,q++),q>=h.length);p++);},purge:function(){this.headers=e=[]}}}});C("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(l,m,f){function c(a){function e(q,n){var w,r={},u={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},v={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};var x=this.SHORT(q);
for(w=0;w<x;w++){var t=q+2+12*w;var y=n[this.SHORT(t)];if(y!==Q){var B=u[this.SHORT(t+=2)];var z=this.LONG(t+=2);var E=v[B];if(!E)throw new f.ImageError(f.ImageError.INVALID_META_ERR);t+=4;4<E*z&&(t=this.LONG(t)+d.tiffHeader);if(t+E*z>=this.length())throw new f.ImageError(f.ImageError.INVALID_META_ERR);"ASCII"===B?r[y]=l.trim(this.STRING(t,z).replace(/\0$/,"")):(B=this.asArray(B,t,z),z=1==z?B[0]:B,g.hasOwnProperty(y)&&"object"!=typeof z?r[y]=g[y][z]:r[y]=z)}}return r}m.call(this,a);var b={tiff:{274:"Orientation",
270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",
41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};var g={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",
12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",
15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",
77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};var d={tiffHeader:10};var k=d.tiffHeader;var p={clear:this.clear};l.extend(this,{read:function(){try{return c.prototype.read.apply(this,arguments)}catch(q){throw new f.ImageError(f.ImageError.INVALID_META_ERR);
}},write:function(){try{return c.prototype.write.apply(this,arguments)}catch(q){throw new f.ImageError(f.ImageError.INVALID_META_ERR);}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(q){return this.LONG(q)/this.LONG(q+4)},SRATIONAL:function(q){return this.SLONG(q)/this.SLONG(q+4)},ASCII:function(q){return this.CHAR(q)},TIFF:function(){return h||null},EXIF:function(){var q=null;if(d.exifIFD){try{q=e.call(this,d.exifIFD,b.exif)}catch(r){return null}if(q.ExifVersion&&
"array"===l.typeOf(q.ExifVersion)){for(var n=0,w="";n<q.ExifVersion.length;n++)w+=String.fromCharCode(q.ExifVersion[n]);q.ExifVersion=w}}return q},GPS:function(){var q=null;if(d.gpsIFD){try{q=e.call(this,d.gpsIFD,b.gps)}catch(n){return null}q.GPSVersionID&&"array"===l.typeOf(q.GPSVersionID)&&(q.GPSVersionID=q.GPSVersionID.join("."))}return q},thumb:function(){if(d.IFD1)try{var q=e.call(this,d.IFD1,b.thumb);if("JPEGInterchangeFormat"in q)return this.SEGMENT(d.tiffHeader+q.JPEGInterchangeFormat,q.JPEGInterchangeFormatLength)}catch(n){}return null},
setExif:function(q,n){if("PixelXDimension"!==q&&"PixelYDimension"!==q)return!1;a:{var w=0;if("string"===typeof q){var r=b.exif;for(u in r)if(r[u]===q){q=u;break}}var u=d.exifIFD;r=this.SHORT(u);for(var v=0;v<r;v++){var x=u+12*v+2;if(this.SHORT(x)==q){w=x+8;break}}if(w){try{this.write(w,n,4)}catch(t){n=!1;break a}n=!0}else n=!1}return n},clear:function(){p.clear();a=b=g=h=d=p=null}});if(65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw new f.ImageError(f.ImageError.INVALID_META_ERR);
this.littleEndian=18761==this.SHORT(k);if(42!==this.SHORT(k+=2))throw new f.ImageError(f.ImageError.INVALID_META_ERR);d.IFD0=d.tiffHeader+this.LONG(k+=2);var h=e.call(this,d.IFD0,b.tiff);"ExifIFDPointer"in h&&(d.exifIFD=d.tiffHeader+h.ExifIFDPointer,delete h.ExifIFDPointer);"GPSInfoIFDPointer"in h&&(d.gpsIFD=d.tiffHeader+h.GPSInfoIFDPointer,delete h.GPSInfoIFDPointer);l.isEmptyObj(h)&&(h=null);if(k=this.LONG(d.IFD0+12*this.SHORT(d.IFD0)+2))d.IFD1=d.tiffHeader+k}c.prototype=m.prototype;return c});
C("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(l,m,f,c,a){return function(e){function b(q){var n=0;for(q||(q=d);n<=q.length();){var w=q.SHORT(n+=2);if(65472<=w&&65475>=w)return n+=5,{height:q.SHORT(n),width:q.SHORT(n+2)};w=q.SHORT(n+=2);n+=w-2}return null}function g(){var q=p.thumb();if(q){var n=new c(q);var w=b(n);n.clear();if(w)return w.data=
q,w}return null}var d=new c(e);if(65496!==d.SHORT(0))throw new m.ImageError(m.ImageError.WRONG_FORMAT);var k=new f(e);try{var p=new a(k.get("app1")[0])}catch(q){}var h=b.call(this);l.extend(this,{type:"image/jpeg",size:d.length(),width:h&&h.width||0,height:h&&h.height||0,setExif:function(q,n){if(!p)return!1;"object"===l.typeOf(q)?l.each(q,function(w,r){p.setExif(r,w)}):p.setExif(q,n);k.set("app1",p.SEGMENT())},writeHeaders:function(){return arguments.length?k.restore(arguments[0]):k.restore(e)},stripHeaders:function(q){return k.strip(q)},
purge:function(){p&&k&&d&&(p.clear(),k.purge(),d.clear(),h=k=p=d=null)}});p&&(this.meta={tiff:p.TIFF(),exif:p.EXIF(),gps:p.GPS(),thumb:g()})}});C("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(l,m,f){return function(c){function a(){e&&(e.clear(),c=b=e=null)}var e=new f(c);(function(){var g=0,d,k=[35152,20039,3338,6666];for(d=0;d<k.length;d++,g+=2)if(k[d]!=e.SHORT(g))throw new l.ImageError(l.ImageError.WRONG_FORMAT);
})();var b=function(){var g=8;var d=e.LONG(g);var k=e.STRING(g+=4,4);var p=g+=4;e.LONG(g+d);return"IHDR"==k?{width:e.LONG(p),height:e.LONG(p+4)}:null}.call(this);m.extend(this,{type:"image/png",size:e.length(),width:b.width,height:b.height,purge:function(){a.call(this)}});a.call(this)}});C("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(l,m,f,c){return function(a){var e=[f,c];var b=function(){for(var g=
0;g<e.length;g++)try{return new e[g](a)}catch(d){}throw new m.ImageError(m.ImageError.WRONG_FORMAT);}();l.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(g){return g},stripHeaders:function(g){return g},purge:function(){a=null}});l.extend(this,b);this.purge=function(){b.purge();b=null}}});C("moxie/runtime/html5/image/MegaPixel",[],function(){function l(m){var f=m.naturalWidth;if(1048576<f*m.naturalHeight){var c=document.createElement("canvas");c.width=c.height=
1;c=c.getContext("2d");c.drawImage(m,-f+1,0);return 0===c.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:l,renderTo:function(m,f,c){var a=m.naturalWidth,e=m.naturalHeight,b=c.width,g=c.height,d=c.x||0;c=c.y||0;f=f.getContext("2d");l(m)&&(a/=2,e/=2);var k=document.createElement("canvas");k.width=k.height=1024;var p=k.getContext("2d");var h=e;var q=document.createElement("canvas");q.width=1;q.height=h;q=q.getContext("2d");q.drawImage(m,0,0);q=q.getImageData(0,0,1,h).data;for(var n=0,w=h,
r=h;r>n;)0===q[4*(r-1)+3]?w=r:n=r,r=w+n>>1;h=r/h;h=0===h?1:h;for(q=0;q<e;){n=q+1024>e?e-q:1024;for(w=0;w<a;)r=w+1024>a?a-w:1024,p.clearRect(0,0,1024,1024),p.drawImage(m,-w,-q),f.drawImage(k,0,0,r,n,w*b/a+d<<0,q*g/e/h+c<<0,Math.ceil(r*b/a),Math.ceil(n*g/e/h)),w+=1024;q+=1024}}}});C("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(l,m,f,c,a,e,b,g,d,k){return l.Image=function(){function p(){if(!t&&!v)throw new f.ImageError(f.DOMException.INVALID_STATE_ERR);return t||v}function h(A){return c.atob(A.substring(A.indexOf("base64,")+7))}function q(A){var F=this;v=new Image;v.onerror=function(){r.call(this);F.trigger("error",f.ImageError.WRONG_FORMAT)};v.onload=function(){F.trigger("load")};v.src="data:"==A.substr(0,5)?A:"data:"+(B.type||"")+";base64,"+c.btoa(A)}function n(A,F){var G=this;if(window.FileReader){var I=new FileReader;
I.onload=function(){F(this.result)};I.onerror=function(){G.trigger("error",f.ImageError.WRONG_FORMAT)};I.readAsDataURL(A)}else return F(A.getAsDataURL())}function w(A,F,G,I){var L=0,T=0;E=I;var S=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;if(-1!==m.inArray(S,[5,6,7,8])){var N=A;A=F;F=N}N=p();if(G){A=Math.min(A,N.width);F=Math.min(F,N.height);var P=Math.max(A/N.width,F/N.height)}else P=Math.min(A/N.width,F/N.height);if(!(1<P&&!G&&I)){t||(t=document.createElement("canvas"));I=Math.round(N.width*
P);P=Math.round(N.height*P);G?(t.width=A,t.height=F,I>A&&(L=Math.round((I-A)/2)),P>F&&(T=Math.round((P-F)/2))):(t.width=I,t.height=P);if(!E){A=t.width;F=t.height;switch(S){case 5:case 6:case 7:case 8:t.width=F;t.height=A;break;default:t.width=A,t.height=F}G=t.getContext("2d");switch(S){case 2:G.translate(A,0);G.scale(-1,1);break;case 3:G.translate(A,F);G.rotate(Math.PI);break;case 4:G.translate(0,F);G.scale(1,-1);break;case 5:G.rotate(.5*Math.PI);G.scale(1,-1);break;case 6:G.rotate(.5*Math.PI);G.translate(0,
-F);break;case 7:G.rotate(.5*Math.PI);G.translate(A,-F);G.scale(-1,1);break;case 8:G.rotate(-.5*Math.PI),G.translate(-A,0)}}S=t;L=-L;T=-T;"iOS"===k.OS?g.renderTo(N,S,{width:I,height:P,x:L,y:T}):S.getContext("2d").drawImage(N,L,T,I,P);this.width=t.width;this.height=t.height;z=!0}this.trigger("Resize")}function r(){x&&(x.purge(),x=null);y=v=t=B=null;z=!1}var u=this,v,x,t,y,B,z=!1,E=!0;m.extend(this,{loadFromBlob:function(A){var F=this,G=F.getRuntime(),I=1<arguments.length?arguments[1]:!0;if(!G.can("access_binary"))throw new f.RuntimeError(f.RuntimeError.NOT_SUPPORTED_ERR);
B=A;A.isDetached()?(y=A.getSource(),q.call(this,y)):n.call(this,A.getSource(),function(L){I&&(y=h(L));q.call(F,L)})},loadFromImage:function(A,F){this.meta=A.meta;B=new e(null,{name:A.name,size:A.size,type:A.type});q.call(this,F?y=A.getAsBinaryString():A.getAsDataURL())},getInfo:function(){var A=this.getRuntime();!x&&y&&A.can("access_image_binary")&&(x=new b(y));A={width:p().width||0,height:p().height||0,type:B.type||d.getFileMime(B.name),size:y&&y.length||B.size||0,name:B.name||"",meta:x&&x.meta||
this.meta||{}};!A.meta||!A.meta.thumb||A.meta.thumb.data instanceof a||(A.meta.thumb.data=new a(null,{type:"image/jpeg",data:A.meta.thumb.data}));return A},downsize:function(){w.apply(this,arguments)},getAsCanvas:function(){t&&(t.id=this.uid+"_canvas");return t},getAsBlob:function(A,F){A!==this.type&&w.call(this,this.width,this.height,!1);return new e(null,{name:B.name||"",type:A,data:u.getAsBinaryString.call(this,A,F)})},getAsDataURL:function(A,F){F=F||90;if(!z)return v.src;if("image/jpeg"!==A)return t.toDataURL("image/png");
try{return t.toDataURL("image/jpeg",F/100)}catch(G){return t.toDataURL("image/jpeg")}},getAsBinaryString:function(A,F){if(!z)return y||(y=h(u.getAsDataURL(A,F))),y;if("image/jpeg"!==A)y=h(u.getAsDataURL(A,F));else{F||(F=90);try{var G=t.toDataURL("image/jpeg",F/100)}catch(I){G=t.toDataURL("image/jpeg")}y=h(G);x&&(y=x.stripHeaders(y),E&&(x.meta&&x.meta.exif&&x.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),y=x.writeHeaders(y)),x.purge(),x=null)}z=!1;return y},destroy:function(){u=
null;r.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});C("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(l,m,f,c,a){function e(){try{var d=navigator.plugins["Shockwave Flash"];d=d.description}catch(k){try{d=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(p){d="0.0"}}d=d.match(/\d+/g);return parseFloat(d[0]+"."+d[1])}function b(d){var k=
f.get(d);k&&"OBJECT"==k.nodeName&&("IE"===m.browser?(k.style.display="none",function h(){if(4==k.readyState){var q=f.get(d);if(q){for(var n in q)"function"==typeof q[n]&&(q[n]=null);q.parentNode.removeChild(q)}}else setTimeout(h,10)}()):k.parentNode.removeChild(k))}var g={};a.addConstructor("flash",function(d){var k=this,p;d=l.extend({swf_url:m.swf_url},d);a.call(this,d,"flash",{access_binary:function(h){return h&&"browser"===k.mode},access_image_binary:function(h){return h&&"browser"===k.mode},display_media:a.capTrue,
do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===k.mode},resize_image:a.capTrue,return_response_headers:!1,return_response_type:function(h){return"json"===h&&window.JSON?!0:!l.arrayDiff(h,["","text","document"])||"browser"===k.mode},return_status_code:function(h){return"browser"===k.mode||!l.arrayDiff(h,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:function(h){return h&&"browser"===k.mode},send_browser_cookies:function(h){return h&&
"browser"===k.mode},send_custom_headers:function(h){return h&&"browser"===k.mode},send_multipart:a.capTrue,slice_blob:function(h){return h&&"browser"===k.mode},stream_upload:function(h){return h&&"browser"===k.mode},summon_file_dialog:!1,upload_filesize:function(h){return 2097152>=l.parseSizeStr(h)||"client"===k.mode},use_http_method:function(h){return!l.arrayDiff(h,["GET","POST"])}},{access_binary:function(h){return h?"browser":"client"},access_image_binary:function(h){return h?"browser":"client"},
report_upload_progress:function(h){return h?"browser":"client"},return_response_type:function(h){return l.arrayDiff(h,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(h){return l.arrayDiff(h,[200,404])?"browser":["client","browser"]},send_binary_string:function(h){return h?"browser":"client"},send_browser_cookies:function(h){return h?"browser":"client"},send_custom_headers:function(h){return h?"browser":"client"},stream_upload:function(h){return h?"client":
"browser"},upload_filesize:function(h){return 2097152<=l.parseSizeStr(h)?"client":"browser"}},"client");10>e()&&(MXI_DEBUG&&m.debug.runtime&&m.log("\tFlash didn't meet minimal version requirement (10)."),this.mode=!1);l.extend(this,{getShim:function(){return f.get(this.uid)},shimExec:function(h,q){var n=[].slice.call(arguments,2);return k.getShim().exec(this.uid,h,q,n)},init:function(){var h=this.getShimContainer();l.extend(h.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",
overflow:"hidden"});var q='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+d.swf_url+'" ';"IE"===m.browser&&(q+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');q+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+d.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+m.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';if("IE"===m.browser){var n=
document.createElement("div");h.appendChild(n);n.outerHTML=q;n=h=null}else h.innerHTML=q;p=setTimeout(function(){k&&!k.initialized&&(k.trigger("Error",new c.RuntimeError(c.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&m.debug.runtime&&m.log("\tFlash failed to initialize within a specified period of time (typically 5s)."))},5E3)},destroy:function(h){return function(){b(k.uid);h.call(k);clearTimeout(p);d=p=h=k=null}}(this.destroy)},g)});return g});C("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime",
"moxie/file/File","moxie/core/utils/Basic"],function(l,m,f){return l.FileInput={init:function(c){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];f.each(b,function(g){a.files.push(new m(e.uid,g))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{name:c.name,accept:c.accept,multiple:c.multiple});this.trigger("ready")}}});C("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(l,
m){return l.Blob={slice:function(f,c,a,e){var b=this.getRuntime();0>c?c=Math.max(f.size+c,0):0<c&&(c=Math.min(c,f.size));0>a?a=Math.max(f.size+a,0):0<a&&(a=Math.min(a,f.size));(f=b.shimExec.call(this,"Blob","slice",c,a,e||""))&&(f=new m(b.uid,f));return f}}});C("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(l,m){function f(c,a){switch(a){case "readAsText":return m.atob(c,"utf8");case "readAsBinaryString":return m.atob(c);case "readAsDataURL":return c}return null}
return l.FileReader={read:function(c,a){var e=this;e.result="";"readAsDataURL"===c&&(e.result="data:"+(a.type||"")+";base64,");e.bind("Progress",function(b,g){g&&(e.result+=f(g,c))},999);return e.getRuntime().shimExec.call(this,"FileReader","readAsBase64",a.uid)}}});C("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(l,m){function f(c,a){switch(a){case "readAsText":return m.atob(c,"utf8");case "readAsBinaryString":return m.atob(c);case "readAsDataURL":return c}return null}
return l.FileReaderSync={read:function(c,a){var e=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",a.uid);if(!e)return null;"readAsDataURL"===c&&(e="data:"+(a.type||"")+";base64,"+e);return f(e,c,a.type)}}});C("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),function(l,m,f,c,a,e,b){return l.XMLHttpRequest={send:function(g,
d){function k(){g.transport=n.mode;n.shimExec.call(q,"XMLHttpRequest","send",g,d)}function p(u,v){n.shimExec.call(q,"XMLHttpRequest","appendBlob",u,v.uid);d=null;k()}function h(u,v){var x=new b;x.bind("TransportingComplete",function(){v(this.result)});x.transport(u.getSource(),u.type,{ruid:n.uid})}var q=this,n=q.getRuntime();m.isEmptyObj(g.headers)||m.each(g.headers,function(u,v){n.shimExec.call(q,"XMLHttpRequest","setRequestHeader",v,u.toString())});if(d instanceof e){var w;d.each(function(u,v){u instanceof
f?w=v:n.shimExec.call(q,"XMLHttpRequest","append",v,u)});if(d.hasBlob()){var r=d.getBlob();r.isDetached()?h(r,function(u){r.destroy();p(w,u)}):p(w,r)}else d=null,k()}else d instanceof f?d.isDetached()?h(d,function(u){d.destroy();d=u.uid;k()}):(d=d.uid,k()):k()},getResponse:function(g){var d,k=this.getRuntime();if(d=k.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){d=new c(k.uid,d);if("blob"===g)return d;try{var p=new a;if(~m.inArray(g,["","text"]))return p.readAsText(d);if("json"===g&&window.JSON)return JSON.parse(p.readAsText(d))}finally{d.destroy()}}return null},
abort:function(g){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});C("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(l,m){return l.Transporter={getAsBlob:function(f){var c=this.getRuntime();return(f=c.shimExec.call(this,"Transporter","getAsBlob",f))?new m(c.uid,f):null}}});C("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic",
"moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(l,m,f,c,a){return l.Image={loadFromBlob:function(e){function b(p){d.shimExec.call(g,"Image","loadFromBlob",p.uid);g=d=null}var g=this,d=g.getRuntime();if(e.isDetached()){var k=new f;k.bind("TransportingComplete",function(){b(k.result.getSource())});k.transport(e.getSource(),e.type,{ruid:d.uid})}else b(e.getSource())},loadFromImage:function(e){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",e.uid)},
getInfo:function(){var e=this.getRuntime(),b=e.shimExec.call(this,"Image","getInfo");!b.meta||!b.meta.thumb||b.meta.thumb.data instanceof c||(b.meta.thumb.data=new c(e.uid,b.meta.thumb.data));return b},getAsBlob:function(e,b){var g=this.getRuntime();return(e=g.shimExec.call(this,"Image","getAsBlob",e,b))?new c(g.uid,e):null},getAsDataURL:function(){var e=this.getRuntime().Image.getAsBlob.apply(this,arguments);return e?(new a).readAsDataURL(e):null}}});C("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic",
"moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(l,m,f,c,a){function e(g){var d=!1,k=null,p,h,q=0;try{try{k=new ActiveXObject("AgControl.AgControl"),k.IsVersionSupported(g)&&(d=!0)}catch(v){var n=navigator.plugins["Silverlight Plug-In"];if(n){var w=n.description;"1.0.30226.2"===w&&(w="2.0.30226.2");for(p=w.split(".");3<p.length;)p.pop();for(;4>p.length;)p.push(0);for(h=g.split(".");4<h.length;)h.pop();do{var r=parseInt(h[q],10);var u=parseInt(p[q],
10);q++}while(q<h.length&&r===u);r<=u&&!isNaN(r)&&(d=!0)}}}catch(v){d=!1}return d}var b={};a.addConstructor("silverlight",function(g){var d=this,k;g=l.extend({xap_url:m.xap_url},g);a.call(this,g,"silverlight",{access_binary:a.capTrue,access_image_binary:a.capTrue,display_media:a.capTrue,do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:a.capTrue,resize_image:a.capTrue,return_response_headers:function(p){return p&&"client"===d.mode},return_response_type:function(p){return"json"!==p?!0:!!window.JSON},
return_status_code:function(p){return"client"===d.mode||!l.arrayDiff(p,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:a.capTrue,send_browser_cookies:function(p){return p&&"browser"===d.mode},send_custom_headers:function(p){return p&&"client"===d.mode},send_multipart:a.capTrue,slice_blob:a.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:a.capTrue,use_http_method:function(p){return"client"===d.mode||!l.arrayDiff(p,["GET","POST"])}},{return_response_headers:function(p){return p?
"client":"browser"},return_status_code:function(p){return l.arrayDiff(p,[200,404])?"client":["client","browser"]},send_browser_cookies:function(p){return p?"browser":"client"},send_custom_headers:function(p){return p?"client":"browser"},use_http_method:function(p){return l.arrayDiff(p,["GET","POST"])?"client":["client","browser"]}});e("2.0.31005.0")&&"Opera"!==m.browser||(MXI_DEBUG&&m.debug.runtime&&m.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely)."),
this.mode=!1);l.extend(this,{getShim:function(){return f.get(this.uid).content.Moxie},shimExec:function(p,h){var q=[].slice.call(arguments,2);return d.getShim().exec(this.uid,p,h,q)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+g.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+
this.uid+",target="+m.global_event_dispatcher+'"/></object>';k=setTimeout(function(){d&&!d.initialized&&(d.trigger("Error",new c.RuntimeError(c.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&m.debug.runtime&&m.log("Silverlight failed to initialize within a specified period of time (5-10s)."))},"Windows"!==m.OS?1E4:5E3)},destroy:function(p){return function(){p.call(d);clearTimeout(k);g=k=p=d=null}}(this.destroy)},b)});return b});C("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime",
"moxie/file/File","moxie/core/utils/Basic"],function(l,m,f){return l.FileInput={init:function(c){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];f.each(b,function(g){a.files.push(new m(e.uid,g))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",function(b){for(var g="",d=0;d<b.length;d++)g+=(""!==g?"|":"")+b[d].title+" | *."+b[d].extensions.replace(/,/g,";*.");return g}(c.accept),c.name,c.multiple);this.trigger("ready")}}});
C("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(l,m,f){return l.Blob=m.extend({},f)});C("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(l,m,f){return l.FileDrop={init:function(){var c=this.getRuntime();var a=c.getShimContainer();f.addEvent(a,"dragover",function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect=
"copy"},this.uid);f.addEvent(a,"dragenter",function(e){e.preventDefault();m.get(c.uid).dragEnter(e)&&e.stopPropagation()},this.uid);f.addEvent(a,"drop",function(e){e.preventDefault();m.get(c.uid).dragDrop(e)&&e.stopPropagation()},this.uid);return c.shimExec.call(this,"FileDrop","init")}}});C("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(l,m,f){return l.FileReader=m.extend({},f)});C("moxie/runtime/silverlight/file/FileReaderSync",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(l,m,f){return l.FileReaderSync=m.extend({},f)});C("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(l,m,f){return l.XMLHttpRequest=m.extend({},f)});C("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],
function(l,m,f){return l.Transporter=m.extend({},f)});C("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(l,m,f,c){return l.Image=m.extend({},c,{getInfo:function(){var a=this.getRuntime(),e=["tiff","exif","gps","thumb"],b={meta:{}},g=a.shimExec.call(this,"Image","getInfo");g.meta&&(m.each(e,function(d){var k=g.meta[d],p,h;if(k&&k.keys){b.meta[d]={};var q=0;for(p=k.keys.length;q<p;q++){var n=
k.keys[q];if(h=k[n])/^(\d|[1-9]\d+)$/.test(h)?h=parseInt(h,10):/^\d*\.\d+$/.test(h)&&(h=parseFloat(h)),b.meta[d][n]=h}}}),!b.meta||!b.meta.thumb||b.meta.thumb.data instanceof f||(b.meta.thumb.data=new f(a.uid,b.meta.thumb.data)));b.width=parseInt(g.width,10);b.height=parseInt(g.height,10);b.size=parseInt(g.size,10);b.type=g.type;b.name=g.name;return b}})});C("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(l,m,
f,c){var a={};f.addConstructor("html4",function(e){var b=this,g=f.capTest,d=f.capTrue;f.call(this,e,"html4",{access_binary:g(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:g(a.Image&&(c.can("create_canvas")||c.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:g("Chrome"===c.browser&&c.verComp(c.version,28,">=")||"IE"===c.browser&&c.verComp(c.version,10,">=")||"Safari"===c.browser&&c.verComp(c.version,7,">=")),resize_image:function(){return a.Image&&
b.can("access_binary")&&c.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(k){return"json"===k&&window.JSON?!0:!!~l.inArray(k,["text","document",""])},return_status_code:function(k){return!l.arrayDiff(k,[200,404])},select_file:function(){return c.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return b.can("select_file")},summon_file_dialog:function(){return b.can("select_file")&&
("Firefox"===c.browser&&c.verComp(c.version,4,">=")||"Opera"===c.browser&&c.verComp(c.version,12,">=")||"IE"===c.browser&&c.verComp(c.version,10,">=")||!!~l.inArray(c.browser,["Chrome","Safari"]))},upload_filesize:d,use_http_method:function(k){return!l.arrayDiff(k,["GET","POST"])}});l.extend(this,{init:function(){this.trigger("Init")},destroy:function(k){return function(){k.call(b);k=b=null}}(this.destroy)});l.extend(this.getShim(),a)});return a});C("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(l,m,f,c,a,e,b){return l.FileInput=function(){function g(){var h=this,q=h.getRuntime(),n;var w=f.guid("uid_");var r=q.getShimContainer();d&&(n=c.get(d+"_form"))&&f.extend(n.style,{top:"100%"});var u=document.createElement("form");u.setAttribute("id",w+"_form");u.setAttribute("method","post");u.setAttribute("enctype","multipart/form-data");u.setAttribute("encoding","multipart/form-data");f.extend(u.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});var v=
document.createElement("input");v.setAttribute("id",w);v.setAttribute("type","file");v.setAttribute("name",p.name||"Filedata");v.setAttribute("accept",k.join(","));f.extend(v.style,{fontSize:"999px",opacity:0});u.appendChild(v);r.appendChild(u);f.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===b.browser&&b.verComp(b.version,10,"<")&&f.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});v.onchange=function(){if(this.value){if(this.files){var x=
this.files[0];if(0===x.size){u.parentNode.removeChild(u);return}}else x={name:this.value};x=new m(q.uid,x);this.onchange=function(){};g.call(h);h.files=[x];v.setAttribute("id",x.uid);u.setAttribute("id",x.uid+"_form");h.trigger("change");v=u=null}};q.can("summon_file_dialog")&&(r=c.get(p.browse_button),a.removeEvent(r,"click",h.uid),a.addEvent(r,"click",function(x){v&&!v.disabled&&v.click();x.preventDefault()},h.uid));d=w;r=n=r=null}var d,k=[],p;f.extend(this,{init:function(h){var q=this,n=q.getRuntime();
p=h;k=h.accept.mimes||e.extList2mimes(h.accept,n.can("filter_by_extension"));var w=n.getShimContainer();(function(){var r=c.get(h.browse_button);if(n.can("summon_file_dialog")){"static"===c.getStyle(r,"position")&&(r.style.position="relative");var u=parseInt(c.getStyle(r,"z-index"),10)||1;r.style.zIndex=u;w.style.zIndex=u-1}r=n.can("summon_file_dialog")?r:w;a.addEvent(r,"mouseover",function(){q.trigger("mouseenter")},q.uid);a.addEvent(r,"mouseout",function(){q.trigger("mouseleave")},q.uid);a.addEvent(r,
"mousedown",function(){q.trigger("mousedown")},q.uid);a.addEvent(c.get(h.container),"mouseup",function(){q.trigger("mouseup")},q.uid);r=null})();g.call(this);w=null;q.trigger({type:"ready",async:!0})},disable:function(h){var q;if(q=c.get(d))q.disabled=!!h},destroy:function(){var h=this.getRuntime(),q=h.getShim();h=h.getShimContainer();a.removeAllEvents(h,this.uid);a.removeAllEvents(p&&c.get(p.container),this.uid);a.removeAllEvents(p&&c.get(p.browse_button),this.uid);h&&(h.innerHTML="");q.removeInstance(this.uid);
d=k=p=null}})}});C("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(l,m){return l.FileReader=m});C("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(l,m,f,c,a,e,b,g){return l.XMLHttpRequest=function(){function d(q){var n=this,w,r=!1;if(h){var u=h.id.replace(/_iframe$/,
"");if(u=f.get(u+"_form")){var v=u.getElementsByTagName("input");for(w=v.length;w--;)switch(v[w].getAttribute("type")){case "hidden":v[w].parentNode.removeChild(v[w]);break;case "file":r=!0}v=[];r||u.parentNode.removeChild(u);u=null}setTimeout(function(){e.removeEvent(h,"load",n.uid);h.parentNode&&h.parentNode.removeChild(h);var x=n.getRuntime().getShimContainer();x.children.length||x.parentNode.removeChild(x);h=null;q()},1)}}var k,p,h;m.extend(this,{send:function(q,n){var w=this,r=w.getRuntime();
k=p=null;if(n instanceof g&&n.hasBlob()){var u=n.getBlob();var v=u.uid;var x=f.get(v);var t=f.get(v+"_form");if(!t)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);}else v=m.guid("uid_"),t=document.createElement("form"),t.setAttribute("id",v+"_form"),t.setAttribute("method",q.method),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),r.getShimContainer().appendChild(t);t.setAttribute("target",v+"_iframe");n instanceof g&&n.each(function(y,B){if(y instanceof
b)x&&x.setAttribute("name",B);else{var z=document.createElement("input");m.extend(z,{type:"hidden",name:B,value:y});x?t.insertBefore(z,x):t.appendChild(z)}});t.setAttribute("action",q.url);(function(){var y=r.getShimContainer()||document.body,B=document.createElement("div");B.innerHTML='<iframe id="'+v+'_iframe" name="'+v+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';h=B.firstChild;y.appendChild(h);e.addEvent(h,"load",function(){try{var z=h.contentWindow.document||h.contentDocument||
window.frames[h.id].document;/^4(0[0-9]|1[0-7]|2[2346])\s/.test(z.title)?k=z.title.replace(/^(\d+).*$/,"$1"):(k=200,p=m.trim(z.body.innerHTML),w.trigger({type:"progress",loaded:p.length,total:p.length}),u&&w.trigger({type:"uploadprogress",loaded:u.size||1025,total:u.size||1025}))}catch(E){if(c.hasSameOrigin(q.url))k=404;else{d.call(w,function(){w.trigger("error")});return}}d.call(w,function(){w.trigger("load")})},w.uid)})();t.submit();w.trigger("loadstart")},getStatus:function(){return k},getResponse:function(q){if("json"===
q&&"string"===m.typeOf(p)&&window.JSON)try{return JSON.parse(p.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return p},abort:function(){var q=this;h&&h.contentWindow&&(h.contentWindow.stop?h.contentWindow.stop():h.contentWindow.document.execCommand?h.contentWindow.document.execCommand("Stop"):h.src="about:blank");d.call(this,function(){q.dispatchEvent("abort")})}})}});C("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],
function(l,m){return l.Image=m});(function(l){for(var m=0;m<l.length;m++){for(var f=R,c=l[m],a=c.split(/[.\/]/),e=0;e<a.length-1;++e)f[a[e]]===Q&&(f[a[e]]={}),f=f[a[e]];f[a[a.length-1]]=V[c]}})("moxie/core/utils/Basic moxie/core/utils/Env moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/FileInput moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/file/FileDrop moxie/file/FileReader moxie/core/utils/Url moxie/runtime/RuntimeTarget moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "))})(this);
(function(R){var Q={},aa=R.moxie.core.utils.Basic.inArray;(function l(V){var m;for(m in V){var f=typeof V[m];"object"!==f||~aa(m,["Exceptions","Env","Mime"])?"function"===f&&(Q[m]=V[m]):l(V[m])}})(R.moxie);Q.Env=R.moxie.core.utils.Env;Q.Mime=R.moxie.core.utils.Mime;Q.Exceptions=R.moxie.core.Exceptions;R.mOxie=Q;R.o||(R.o=Q);return Q})(this);
