(function(Q,e,F){function R(d){function g(y,G,N){var H={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};H[y]?v[H[y]]=G:N||(v[y]=G)}var h=d.required_features,v={};if("string"===typeof h)c.each(h.split(/\s*,\s*/),function(y){g(y,
!0)});else if("object"===typeof h)c.each(h,function(y,G){g(G,y)});else if(!0===h){0<d.chunk_size&&(v.slice_blob=!0);if(d.resize.enabled||!d.multipart)v.send_binary_string=!0;c.each(d,function(y,G){g(G,!!y,!0)})}return v}var I=Q.setTimeout,O={},c={VERSION:"2.1.8",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,
MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,get:function(d){var g=[],h;"array"!==e.typeOf(d)&&(d=[d]);for(var v=d.length;v--;)(h=e.get(d[v]))&&g.push(h);return g.length?g:null},each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(d){var g={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},h=/[<>&"']/g;return d?(""+d).replace(h,function(v){return g[v]?"&"+g[v]+";":v}):d},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,
translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(d){var g;var h=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(g=0;g<h.length;g+=
2)d=d.replace(h[g],h[g+1]);d=d.replace(/\s+/g,"_");return d=d.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(d,g){var h="";c.each(g,function(v,y){h+=(h?"&":"")+encodeURIComponent(y)+"="+encodeURIComponent(v)});h&&(d+=(0<d.indexOf("?")?"&":"?")+h);return d},formatSize:function(d){function g(v,y){return Math.round(v*Math.pow(10,y))/Math.pow(10,y)}if(d===F||/\D/.test(d))return c.translate("N/A");var h=Math.pow(1024,4);return d>h?g(d/h,1)+" "+c.translate("tb"):d>(h/=1024)?g(d/h,1)+" "+c.translate("gb"):
d>(h/=1024)?g(d/h,1)+" "+c.translate("mb"):1024<d?Math.round(d/1024)+" "+c.translate("kb"):d+" "+c.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(d,g){var h=new c.Uploader(d);d=e.Runtime.thatCan(h.getOption().required_features,g||d.runtimes);h.destroy();return d},addFileFilter:function(d,g){O[d]=g}};c.addFileFilter("mime_types",function(d,g,h){d.length&&!d.regexp.test(g.name)?(this.trigger("Error",{code:c.FILE_EXTENSION_ERROR,message:c.translate("File extension error."),file:g}),
h(!1)):h(!0)});c.addFileFilter("max_file_size",function(d,g,h){d=c.parseSize(d);void 0!==g.size&&d&&g.size>d?(this.trigger("Error",{code:c.FILE_SIZE_ERROR,message:c.translate("File size error."),file:g}),h(!1)):h(!0)});c.addFileFilter("prevent_duplicates",function(d,g,h){if(d)for(d=this.files.length;d--;)if(g.name===this.files[d].name&&g.size===this.files[d].size){this.trigger("Error",{code:c.FILE_DUPLICATE_ERROR,message:c.translate("Duplicate file error."),file:g});h(!1);return}h(!0)});c.Uploader=
function(d){function g(){var a=0,b;if(this.state==c.STARTED){for(b=0;b<x.length;b++)if(k||x[b].status!=c.QUEUED)a++;else{var k=x[b];this.trigger("BeforeUpload",k)&&(k.status=c.UPLOADING,this.trigger("UploadFile",k))}a==x.length&&(this.state!==c.STOPPED&&(this.state=c.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",x))}}function h(a){a.percent=0<a.size?Math.ceil(a.loaded/a.size*100):100;v()}function v(){var a;w.reset();for(a=0;a<x.length;a++){var b=x[a];b.size!==F?(w.size+=b.origSize,
w.loaded+=b.loaded*b.origSize/b.size):w.size=F;b.status==c.DONE?w.uploaded++:b.status==c.FAILED?w.failed++:w.queued++}w.size===F?w.percent=0<x.length?Math.ceil(w.uploaded/x.length*100):0:(w.bytesPerSec=Math.ceil(w.loaded/((+new Date-P||1)/1E3)),w.percent=0<w.size?Math.ceil(w.loaded/w.size*100):0)}function y(){var a=C[0]||J[0];return a?a.getRuntime().uid:!1}function G(a,b){return a.ruid&&(a=e.Runtime.getInfo(a.ruid))?a.can(b):!1}function N(){this.bind("FilesAdded FilesRemoved",function(a){a.trigger("QueueChanged");
a.refresh()});this.bind("CancelUpload",U);this.bind("BeforeUpload",V);this.bind("UploadFile",W);this.bind("UploadProgress",X);this.bind("StateChanged",Y);this.bind("QueueChanged",v);this.bind("Error",Z);this.bind("FileUploaded",aa);this.bind("Destroy",ba)}function H(a,b){var k=this,l=0,t=[],u={runtime_order:a.runtimes,required_caps:a.required_features,preferred_caps:K,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};c.each(a.runtimes.split(/\s*,\s*/),function(q){a[q]&&(u[q]=a[q])});a.browse_button&&
c.each(a.browse_button,function(q){t.push(function(m){var f=new e.FileInput(c.extend({},u,{accept:a.filters.mime_types,name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:q}));f.onready=function(){var n=e.Runtime.getInfo(this.ruid);e.extend(k.features,{chunks:n.can("slice_blob"),multipart:n.can("send_multipart"),multi_selection:n.can("select_multiple")});l++;C.push(this);m()};f.onchange=function(){k.addFile(this.files)};f.bind("mouseenter mouseleave mousedown mouseup",
function(n){L||(a.browse_button_hover&&("mouseenter"===n.type?e.addClass(q,a.browse_button_hover):"mouseleave"===n.type&&e.removeClass(q,a.browse_button_hover)),a.browse_button_active&&("mousedown"===n.type?e.addClass(q,a.browse_button_active):"mouseup"===n.type&&e.removeClass(q,a.browse_button_active)))});f.bind("mousedown",function(){k.trigger("Browse")});f.bind("error runtimeerror",function(){f=null;m()});f.init()})});a.drop_element&&c.each(a.drop_element,function(q){t.push(function(m){var f=new e.FileDrop(c.extend({},
u,{drop_zone:q}));f.onready=function(){var n=e.Runtime.getInfo(this.ruid);k.features.dragdrop=n.can("drag_and_drop");l++;J.push(this);m()};f.ondrop=function(){k.addFile(this.files)};f.bind("error runtimeerror",function(){f=null;m()});f.init()})});e.inSeries(t,function(){"function"===typeof b&&b(l)})}function ca(a,b,k){var l=new e.Image;try{l.onload=function(){if(b.width>this.width&&b.height>this.height&&b.quality===F&&b.preserve_headers&&!b.crop)return this.destroy(),k(a);l.downsize(b.width,b.height,
b.crop,b.preserve_headers)},l.onresize=function(){k(this.getAsBlob(a.type,b.quality));this.destroy()},l.onerror=function(){k(a)},l.load(a)}catch(t){k(a)}}function S(a,b,k){function l(q,m,f){var n=p[q];switch(q){case "max_file_size":"max_file_size"===q&&(p.max_file_size=p.filters.max_file_size=m);break;case "chunk_size":if(m=c.parseSize(m))p[q]=m,p.send_file_name=!0;break;case "multipart":p[q]=m;m||(p.send_file_name=!0);break;case "unique_names":if(p[q]=m)p.send_file_name=!0;break;case "filters":"array"===
c.typeOf(m)&&(m={mime_types:m});f?c.extend(p.filters,m):p.filters=m;m.mime_types&&(p.filters.mime_types.regexp=function(z){var A=[];c.each(z,function(B){c.each(B.extensions.split(/,/),function(D){/^\s*\*\s*$/.test(D)?A.push("\\.*"):A.push("\\."+D.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});return new RegExp("("+A.join("|")+")$","i")}(p.filters.mime_types));break;case "resize":f?c.extend(p.resize,m,{enabled:!0}):p.resize=m;break;case "prevent_duplicates":p.prevent_duplicates=
p.filters.prevent_duplicates=!!m;break;case "browse_button":case "drop_element":m=c.get(m);case "container":case "runtimes":case "multi_selection":case "flash_swf_url":case "silverlight_xap_url":p[q]=m;f||(u=!0);break;default:p[q]=m}f||t.trigger("OptionChanged",q,m,n)}var t=this,u=!1;"object"===typeof a?c.each(a,function(q,m){l(m,q,k)}):l(a,b,k);k?(p.required_features=R(c.extend({},p)),K=R(c.extend({},p,{required_features:!0}))):u&&(t.trigger("Destroy"),H.call(t,p,function(q){q?(t.runtime=e.Runtime.getInfo(y()).type,
t.trigger("Init",{runtime:t.runtime}),t.trigger("PostInit")):t.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}))}function V(a,b){if(a.settings.unique_names){a=b.name.match(/\.([^.]+)$/);var k="part";a&&(k=a[1]);b.target_name=b.id+"."+k}}function W(a,b){function k(){0<q--?I(l,1E3):(b.loaded=f,a.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:b,response:r.responseText,status:r.status,responseHeaders:r.getAllResponseHeaders()}))}function l(){var z=
{};if(b.status===c.UPLOADING&&a.state!==c.STOPPED){a.settings.send_file_name&&(z.name=b.target_name||b.name);if(u&&m.chunks&&n.size>u){var A=Math.min(u,n.size-f);var B=n.slice(f,f+A)}else A=n.size,B=n;u&&m.chunks&&(a.settings.send_chunk_number?(z.chunk=Math.ceil(f/u),z.chunks=Math.ceil(n.size/u)):(z.offset=f,z.total=n.size));r=new e.XMLHttpRequest;r.upload&&(r.upload.onprogress=function(E){b.loaded=Math.min(b.size,f+E.loaded);a.trigger("UploadProgress",b)});r.onload=function(){400<=r.status?k():(q=
a.settings.max_retries,A<n.size?(B.destroy(),f+=A,b.loaded=Math.min(f,n.size),a.trigger("ChunkUploaded",b,{offset:b.loaded,total:n.size,response:r.responseText,status:r.status,responseHeaders:r.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&a.trigger("UploadProgress",b)):b.loaded=b.size,B=D=null,!f||f>=n.size?(b.size!=b.origSize&&(n.destroy(),n=null),a.trigger("UploadProgress",b),b.status=c.DONE,a.trigger("FileUploaded",b,{response:r.responseText,status:r.status,responseHeaders:r.getAllResponseHeaders()})):
I(l,1))};r.onerror=function(){k()};r.onloadend=function(){this.destroy();r=null};if(a.settings.multipart&&m.multipart){r.open("post",t,!0);c.each(a.settings.headers,function(E,M){r.setRequestHeader(M,E)});var D=new e.FormData;c.each(c.extend(z,a.settings.multipart_params),function(E,M){D.append(M,E)});D.append(a.settings.file_data_name,B);r.send(D,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:K,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})}else t=
c.buildUrl(a.settings.url,c.extend(z,a.settings.multipart_params)),r.open("post",t,!0),r.setRequestHeader("Content-Type","application/octet-stream"),c.each(a.settings.headers,function(E,M){r.setRequestHeader(M,E)}),r.send(B,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:K,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})}}var t=a.settings.url,u=a.settings.chunk_size,q=a.settings.max_retries,m=a.features,f=0;b.loaded&&(f=b.loaded=
u?u*Math.floor(b.loaded/u):0);var n=b.getSource();a.settings.resize.enabled&&G(n,"send_binary_string")&&~e.inArray(n.type,["image/jpeg","image/png"])?ca.call(this,n,a.settings.resize,function(z){n=z;b.size=z.size;l()}):l()}function X(a,b){h(b)}function Y(a){if(a.state==c.STARTED)P=+new Date;else if(a.state==c.STOPPED)for(var b=a.files.length-1;0<=b;b--)a.files[b].status==c.UPLOADING&&(a.files[b].status=c.QUEUED,v())}function U(){r&&r.abort()}function aa(a){v();I(function(){g.call(a)},1)}function Z(a,
b){b.code===c.INIT_ERROR?a.destroy():b.code===c.HTTP_ERROR&&(b.file.status=c.FAILED,h(b.file),a.state==c.STARTED&&(a.trigger("CancelUpload"),I(function(){g.call(a)},1)))}function ba(a){a.stop();c.each(x,function(b){b.destroy()});x=[];C.length&&(c.each(C,function(b){b.destroy()}),C=[]);J.length&&(c.each(J,function(b){b.destroy()}),J=[]);K={};L=!1;P=r=null;w.reset()}var T=c.guid(),x=[],K={},C=[],J=[],P,L=!1,r;var p={runtimes:e.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,
file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0};S.call(this,d,null,!0);var w=new c.QueueProgress;c.extend(this,{id:T,uid:T,state:c.STOPPED,features:{},runtime:null,files:x,settings:p,total:w,init:function(){var a=this;"function"==typeof p.preinit?p.preinit(a):c.each(p.preinit,function(b,k){a.bind(k,b)});N.call(this);
p.browse_button&&p.url?H.call(this,p,function(b){"function"==typeof p.init?p.init(a):c.each(p.init,function(k,l){a.bind(l,k)});b?(a.runtime=e.Runtime.getInfo(y()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}):this.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})},setOption:function(a,b){S.call(this,a,b,!this.runtime)},getOption:function(a){return a?p[a]:p},refresh:function(){C.length&&
c.each(C,function(a){a.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=c.STARTED&&(this.state=c.STARTED,this.trigger("StateChanged"),g.call(this))},stop:function(){this.state!=c.STOPPED&&(this.state=c.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(a){L=a!==F?a:!0;C.length&&c.each(C,function(b){b.disable(L)});this.trigger("DisableBrowse",L)},getFile:function(a){var b;for(b=x.length-1;0<=b;b--)if(x[b].id===a)return x[b]},addFile:function(a,
b){function k(f,n){var z=[];e.each(t.settings.filters,function(A,B){O[B]&&z.push(function(D){O[B].call(t,A,f,function(E){D(!E)})})});e.inSeries(z,n)}function l(f){var n=e.typeOf(f);if(f instanceof e.File){if(!f.ruid&&!f.isDetached()){if(!m)return!1;f.ruid=m;f.connectRuntime(m)}l(new c.File(f))}else f instanceof e.Blob?(l(f.getSource()),f.destroy()):f instanceof c.File?(b&&(f.name=b),u.push(function(z){k(f,function(A){A||(x.push(f),q.push(f),t.trigger("FileFiltered",f));I(z,1)})})):-1!==e.inArray(n,
["file","blob"])?l(new e.File(null,f)):"node"===n&&"filelist"===e.typeOf(f.files)?e.each(f.files,l):"array"===n&&(b=null,e.each(f,l))}var t=this,u=[],q=[];var m=y();l(a);u.length&&e.inSeries(u,function(){q.length&&t.trigger("FilesAdded",q)})},removeFile:function(a){a="string"===typeof a?a:a.id;for(var b=x.length-1;0<=b;b--)if(x[b].id===a)return this.splice(b,1)[0]},splice:function(a,b){a=x.splice(a===F?0:a,b===F?x.length:b);var k=!1;this.state==c.STARTED&&(c.each(a,function(l){if(l.status===c.UPLOADING)return k=
!0,!1}),k&&this.stop());this.trigger("FilesRemoved",a);c.each(a,function(l){l.destroy()});k&&this.start();return a},dispatchEvent:function(a){var b;a=a.toLowerCase();if(b=this.hasEventListener(a)){b.sort(function(t,u){return u.priority-t.priority});var k=[].slice.call(arguments);k.shift();k.unshift(this);for(var l=0;l<b.length;l++)if(!1===b[l].fn.apply(b[l].scope,k))return!1}return!0},bind:function(a,b,k,l){c.Uploader.prototype.bind.call(this,a,b,l,k)},destroy:function(){this.trigger("Destroy");p=
w=null;this.unbindAll()}})};c.Uploader.prototype=e.EventTarget.instance;c.File=function(){var d={};return function(g){c.extend(this,{id:c.guid(),name:g.name||g.fileName,type:g.type||"",size:g.size||g.fileSize,origSize:g.size||g.fileSize,loaded:0,percent:0,status:c.QUEUED,lastModifiedDate:g.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var h=this.getSource().getSource();return-1!==e.inArray(e.typeOf(h),["blob","file"])?h:null},getSource:function(){return d[this.id]?d[this.id]:
null},destroy:function(){var h=this.getSource();h&&(h.destroy(),delete d[this.id])}});d[this.id]=g}}();c.QueueProgress=function(){var d=this;d.size=0;d.loaded=0;d.uploaded=0;d.failed=0;d.queued=0;d.percent=0;d.bytesPerSec=0;d.reset=function(){d.size=d.loaded=d.uploaded=d.failed=d.queued=d.percent=d.bytesPerSec=0}};Q.plupload=c})(window,mOxie);
