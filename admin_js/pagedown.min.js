var Markdown;Markdown="object"===typeof exports&&"function"===typeof require?exports:{};
(function(){function T(E){return E}function da(E){return!1}function Z(){}function W(){}Z.prototype={chain:function(E,S){var U=this[E];if(!U)throw Error("unknown hook "+E);this[E]=U===T?S:function(aa){var N=Array.prototype.slice.call(arguments,0);N[0]=U.apply(null,N);return S.apply(null,N)}},set:function(E,S){if(!this[E])throw Error("unknown hook "+E);this[E]=S},addNoop:function(E){this[E]=T},addFalse:function(E){this[E]=da}};Markdown.HookCollection=Z;W.prototype={set:function(E,S){this["s_"+E]=S},
get:function(E){return this["s_"+E]}};Markdown.Converter=function(E){function S(b){return b=b.replace(/^[ ]{0,3}\[([^\[\]]+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(k,t,p,r,z,C){t=t.toLowerCase();D.set(t,n(p));if(z)return r;C&&f.set(t,C.replace(/"/g,"&quot;"));return""})}function U(b){b=b.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,N);b=b.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,
N);b=b.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,N);b=b.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,N);return b=b.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,N)}function aa(b){b=b.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(y.push(b)-1)+"K\n\n"}function N(b,k){return aa(k)}function Y(b,k){b=h.preBlockGamut(b,L);b=K(b);b=b.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n");b=b.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,
"<hr />\n");b=b.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n");b=X(b);b=ea(b);b=e(b);b=h.postBlockGamut(b,L);b=U(b);return b=g(b,k)}function V(b){b=h.preSpanGamut(b);b=I(b);b=A(b);b=b.replace(/\\(\\)/g,J);b=b.replace(/\\([`*_{}\[\]()>#+-.!])/g,J);-1!==b.indexOf("![")&&(b=b.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,v),b=b.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,v));-1!==b.indexOf("[")&&(b=b.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,
R),b=b.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,R),b=b.replace(/(\[([^\[\]]+)\])()()()()()/g,R));b=x(b);b=b.replace(/~P/g,"://");b=n(b);b=H(b);b=b.replace(/  +\n/g," <br>\n");return b=h.postSpanGamut(b)}function A(b){return b=b.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(k){var t=k.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=F(t,"!"==k.charAt(1)?"\\`*_/":"\\`*_")})}
function R(b,k,t,p,r,z,C,B){void 0==B&&(B="");b=t.replace(/:\/\//g,"~P");p=p.toLowerCase();if(""==r)if(""==p&&(p=b.toLowerCase().replace(/ ?\n/g," ")),void 0!=D.get(p))r=D.get(p),void 0!=f.get(p)&&(B=f.get(p));else if(-1<k.search(/\(\s*\)$/m))r="";else return k;r=w(r);k='<a href="'+r+'"';""!=B&&(B=O(B),B=F(B,"*_"),k+=' title="'+B+'"');return k+(">"+b+"</a>")}function O(b){return b.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function v(b,k,t,p,r,z,C,B){b=
t;p=p.toLowerCase();B||(B="");if(""==r)if(""==p&&(p=b.toLowerCase().replace(/ ?\n/g," ")),void 0!=D.get(p))r=D.get(p),void 0!=f.get(p)&&(B=f.get(p));else return k;b=F(O(b),"*_[]()");r=F(r,"*_");k='<img src="'+r+'" alt="'+b+'"';B=O(B);B=F(B,"*_");return k+(' title="'+B+'" />')}function K(b){b=b.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(k,t){return"<h1>"+V(t)+"</h1>\n\n"});b=b.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(k,t){return"<h2>"+V(t)+"</h2>\n\n"});return b=b.replace(/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm,
function(k,t,p){k=t.length;return"<h"+k+">"+V(p)+"</h"+k+">\n\n"})}function X(b,k){b+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;G?b=b.replace(t,function(p,r,z){p=-1<z.search(/[*+-]/g)?"ul":"ol";var C;"ol"===p&&(C=parseInt(z,10));r=P(r,p,k);r=r.replace(/\s+$/,"");z="<"+p;C&&1!==C&&(z+=' start="'+C+'"');return z+">"+r+"</"+p+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,
b=b.replace(t,function(p,r,z,C){p=-1<C.search(/[*+-]/g)?"ul":"ol";var B;"ol"===p&&(B=parseInt(C,10));z=P(z,p);C="<"+p;B&&1!==B&&(C+=' start="'+B+'"');return r+C+">\n"+z+"</"+p+">\n"}));return b=b.replace(/~0/,"")}function P(b,k,t){G++;b=b.replace(/\n{2,}$/,"\n");k=fa[k];var p=!1;b=(b+"~0").replace(new RegExp("(^[ \\t]*)("+k+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+k+")[ \\t]+))","gm"),function(r,z,C,B){r=B;(z=/\n\n$/.test(r))||-1<r.search(/\n{2,}/)||p?r=Y(u(r),!0):(r=X(u(r),!0),r=r.replace(/\n$/,""),
t||(r=V(r)));p=z;return"<li>"+r+"</li>\n"});b=b.replace(/~0/g,"");G--;return b}function ea(b){b=(b+"~0").replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(k,t,p){k=a(u(t));k=q(k);k=k.replace(/^\n+/g,"");k=k.replace(/\n+$/g,"");return"\n\n<pre><code>"+(k+"\n</code></pre>\n\n")+p});return b=b.replace(/~0/,"")}function I(b){return b=b.replace(/(^|[^\\`])(`+)(?!`)([^\r]*?[^`])\2(?!`)/gm,function(k,t,p,r,z){k=r.replace(/^([ \t]*)/g,"");k=k.replace(/[ \t]*$/g,"");k=
a(k);k=k.replace(/:\/\//g,"~P");return t+"<code>"+k+"</code>"})}function a(b){b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");return b=F(b,"*_{}[]\\",!1)}function c(b){if(-1===b.indexOf("*")&&-1===b.indexOf("_"))return b;b=M(b);b=b.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)\2(?=\S)([^\r]*?\S)\2\2(?!\2)(?=[\W_]|$)/g,"$1<strong>$3</strong>");b=b.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)(?=\S)((?:(?!\2)[^\r])*?\S)\2(?!\2)(?=[\W_]|$)/g,"$1<em>$3</em>");return ba(b)}function d(b){if(-1===
b.indexOf("*")&&-1===b.indexOf("_"))return b;b=M(b);b=b.replace(/(?=[^\r][*_]|[*_])(^|(?=\W__|(?!\*)[\W_]\*\*|\w\*\*\w)[^\r])(\*\*|__)(?!\2)(?=\S)((?:|[^\r]*?(?!\2)[^\r])(?=\S_|\w|\S\*\*(?:[\W_]|$)).)(?=__(?:\W|$)|\*\*(?:[^*]|$))\2/g,"$1<strong>$3</strong>");b=b.replace(/(?=[^\r][*_]|[*_])(^|(?=\W_|(?!\*)(?:[\W_]\*|\D\*(?=\w)\D))[^\r])(\*|_)(?!\2\2\2)(?=\S)((?:(?!\2)[^\r])*?(?=[^\s_]_|(?=\w)\D\*\D|[^\s*]\*(?:[\W_]|$)).)(?=_(?:\W|$)|\*(?:[^*]|$))\2/g,"$1<em>$3</em>");return ba(b)}function e(b){return b=
b.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(k,t){k=t.replace(/^[ \t]*>[ \t]?/gm,"~0");k=k.replace(/~0/g,"");k=k.replace(/^[ \t]+$/gm,"");k=Y(k);k=k.replace(/(^|\n)/g,"$1  ");k=k.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(p,r){p=r.replace(/^  /mg,"~0");return p=p.replace(/~0/g,"")});return aa("<blockquote>\n"+k+"\n</blockquote>")})}function g(b,k){b=b.replace(/^\n+/g,"");b=b.replace(/\n+$/g,"");b=b.split(/\n{2,}/g);for(var t=[],p=/~K(\d+)K/,r=b.length,z=0;z<r;z++){var C=b[z];p.test(C)?
t.push(C):/\S/.test(C)&&(C=V(C),C=C.replace(/^([ \t]*)/g,"<p>"),C+="</p>",t.push(C))}if(!k)for(r=t.length,z=0;z<r;z++)for(var B=!0;B;)B=!1,t[z]=t[z].replace(/~K(\d+)K/g,function(ia,ha){B=!0;return y[ha]});return t.join("\n\n")}function n(b){b=b.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return b=b.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;")}function l(b,k,t,p){if(k)return b;if(")"!==p.charAt(p.length-1))return"<"+t+p+">";b=p.match(/[()]/g);for(var r=k=0;r<b.length;r++)"("===b[r]?0>=k?k=1:k++:
k--;var z="";0>k&&(p=p.replace(new RegExp("\\){1,"+-k+"}$"),function(C){z=C;return""}));z&&(b=p.charAt(p.length-1),Q.test(b)||(z=b+z,p=p.substr(0,p.length-1)));return"<"+t+p+">"+z}function x(b){b=b.replace(ca,l);return b=b.replace(/<((https?|ftp):[^'">\s]+)>/gi,function(k,t){return'<a href="'+w(t)+'">'+h.plainLinkText(t)+"</a>"})}function m(b){return b=b.replace(/~E(\d+)E/g,function(k,t){k=parseInt(t);return String.fromCharCode(k)})}function u(b){b=b.replace(/^(\t|[ ]{1,4})/gm,"~0");return b=b.replace(/~0/g,
"")}function q(b){if(!/\t/.test(b))return b;var k=["    ","   ","  "," "],t=0,p;return b.replace(/[\n\t]/g,function(r,z){if("\n"===r)return t=z+1,r;p=(z-t)%4;t=z+1;return k[p]})}function w(b){b=O(b);return b=F(b,"*_:()[]")}function F(b,k,t){k="(["+k.replace(/([\[\]\\])/g,"\\$1")+"])";t&&(k="\\\\"+k);return b=b.replace(new RegExp(k,"g"),J)}function J(b,k){return"~E"+k.charCodeAt(0)+"E"}var h=this.hooks=new Z;h.addNoop("plainLinkText");h.addNoop("preConversion");h.addNoop("postNormalization");h.addNoop("preBlockGamut");
h.addNoop("postBlockGamut");h.addNoop("preSpanGamut");h.addNoop("postSpanGamut");h.addNoop("postConversion");var D,f,y,G;E=E||{};var M=T,ba=T;E.nonAsciiLetters&&function(){var b=/[Q\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u203f-\u2040\u2054\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua67f-\ua697\ua717-\ua71f\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe33-\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/g;
M=function(k){return k.replace(b,function(t){t=t.charCodeAt(0);for(var p="",r;0<t;)r=t%51+65,81<=r&&r++,90<r&&(r+=6),p=String.fromCharCode(r)+p,t=t/51|0;return"Q"+p+"Q"})};ba=function(k){return k.replace(/Q([A-PR-Za-z]{1,3})Q/g,function(t,p){t=0;for(var r,z=0;z<p.length;z++)r=p.charCodeAt(z),90<r&&(r-=6),81<r&&r--,r-=65,t=51*t+r;return String.fromCharCode(t)})}}();var H=E.asteriskIntraWordEmphasis?d:c;this.makeHtml=function(b){if(D)throw Error("Recursive call to converter.makeHtml");D=new W;f=new W;
y=[];G=0;b=h.preConversion(b);b=b.replace(/~/g,"~T");b=b.replace(/\$/g,"~D");b=b.replace(/\r\n/g,"\n");b=b.replace(/\r/g,"\n");b=q("\n\n"+b+"\n\n");b=b.replace(/^[ \t]+$/mg,"");b=h.postNormalization(b);b=U(b);b=S(b);b=Y(b);b=m(b);b=b.replace(/~D/g,"$$");b=b.replace(/~T/g,"~");b=h.postConversion(b);y=f=D=null;return b};var L=function(b){return Y(b)},fa={ol:"\\d+[.]",ul:"[*+-]"},ca=/(="|<)?\b(https?|ftp)(:\/\/[-A-Z0-9+&@#/%?=~_|[\]()!:,.;]*[-A-Z0-9+&@#/%=~_|[\])])(?=$|\W)/gi,Q=/[-A-Z0-9+&@#/%=~_|[\])]/i}})();
(function(){function T(){}function da(a){this.buttonBar=v.getElementById("wmd-button-bar"+a);this.preview=v.getElementById("wmd-preview"+a);this.input=v.getElementById("text")}function Z(a,c){var d=this,e=[],g=0,n="none",l,x,m,u=function(h,D){n!=h&&(n=h,D||w());P.isIE&&"moving"==n?m=null:x=setTimeout(q,1)},q=function(h){m=new W(c,h);x=void 0};this.setCommandMode=function(){n="command";w();x=setTimeout(q,0)};this.canUndo=function(){return 1<g};this.canRedo=function(){return e[g+1]?!0:!1};this.undo=
function(){d.canUndo()&&(l?(l.restore(),l=null):(e[g]=new W(c),e[--g].restore(),a&&a()));n="none";c.input.focus();q()};this.redo=function(){d.canRedo()&&(e[++g].restore(),a&&a());n="none";c.input.focus();q()};var w=function(){var h=m||new W(c);if(!h)return!1;"moving"==n?l||(l=h):(l&&(e[g-1].text!=l.text&&(e[g++]=l),l=null),e[g++]=h,e[g+1]=null,a&&a())},F=function(h){var D=!1;if((h.ctrlKey||h.metaKey)&&!h.altKey)switch(String.fromCharCode(h.charCode||h.keyCode).toLowerCase()){case "y":d.redo();D=!0;
break;case "z":h.shiftKey?d.redo():d.undo(),D=!0}D&&(h.preventDefault&&h.preventDefault(),window.event&&(window.event.returnValue=!1))},J=function(h){h.ctrlKey||h.metaKey||(h=h.keyCode,33<=h&&40>=h||63232<=h&&63235>=h?u("moving"):8==h||46==h||127==h?u("deleting"):13==h?u("newlines"):27==h?u("escape"):(16>h||20<h)&&91!=h&&u("typing"))};(function(){A.addEvent(c.input,"keypress",function(D){!D.ctrlKey&&!D.metaKey||D.altKey||89!=D.keyCode&&90!=D.keyCode||D.preventDefault()});var h=function(){(P.isIE||
m&&m.text!=c.input.value)&&void 0==x&&(n="paste",w(),q())};A.addEvent(c.input,"keydown",F);A.addEvent(c.input,"keydown",J);A.addEvent(c.input,"mousedown",function(){u("moving")});c.input.onpaste=h;c.input.ondrop=h})();q(!0);w()}function W(a,c){var d=this,e=a.input;this.init=function(){A.isVisible(e)&&(c||!v.activeElement||v.activeElement===e)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=e.scrollTop,!this.text&&e.selectionStart||0===e.selectionStart)&&(this.text=e.value)};this.setInputAreaSelection=
function(){if(A.isVisible(e))if(void 0!==e.selectionStart&&!P.isOpera)e.focus(),e.selectionStart=d.start,e.selectionEnd=d.end,e.scrollTop=d.scrollTop;else if(v.selection&&(!v.activeElement||v.activeElement===e)){e.focus();var g=e.createTextRange();g.moveStart("character",-e.value.length);g.moveEnd("character",-e.value.length);g.moveEnd("character",d.end);g.moveStart("character",d.start);g.select()}};this.setInputAreaSelectionStartEnd=function(){if(!a.ieCachedRange&&(e.selectionStart||0===e.selectionStart))d.start=
e.selectionStart,d.end=e.selectionEnd;else if(v.selection){d.text=A.fixEolChars(e.value);var g=a.ieCachedRange||v.selection.createRange(),n=A.fixEolChars(g.text),l="\u0007"+n+"\u0007";g.text=l;var x=A.fixEolChars(e.value);g.moveStart("character",-l.length);g.text=n;d.start=x.indexOf("\u0007");d.end=x.lastIndexOf("\u0007")-1;if(l=d.text.length-A.fixEolChars(e.value).length){for(g.moveStart("character",-n.length);l--;)n+="\n",d.end+=1;g.text=n}a.ieCachedRange&&(d.scrollTop=a.ieCachedScrollTop);a.ieCachedRange=
null;this.setInputAreaSelection()}};this.restore=function(){void 0!=d.text&&d.text!=e.value&&(e.value=d.text);this.setInputAreaSelection();e.scrollTop=d.scrollTop};this.getChunks=function(){var g=new T;g.before=A.fixEolChars(d.text.substring(0,d.start));g.startTag="";g.selection=A.fixEolChars(d.text.substring(d.start,d.end));g.endTag="";g.after=A.fixEolChars(d.text.substring(d.end));g.scrollTop=d.scrollTop;return g};this.setChunks=function(g){g.before+=g.startTag;g.after=g.endTag+g.after;this.start=
g.before.length;this.end=g.before.length+g.selection.length;this.text=g.before+g.selection+g.after;this.scrollTop=g.scrollTop};this.init()}function E(a,c,d){var e,g,n,l=function(){var f=0;window.innerHeight?f=window.pageYOffset:v.documentElement&&v.documentElement.scrollTop?f=v.documentElement.scrollTop:v.body&&(f=v.body.scrollTop);return f},x=function(){if(c.preview){var f=c.input.value;if(!f||f!=n){n=f;var y=(new Date).getTime();f=a.makeHtml(f);g=(new Date).getTime()-y;D(f)}}},m=function(){e&&(clearTimeout(e),
e=void 0);var f=g;3E3<f&&(f=3E3);e=setTimeout(x,f)},u=function(f){return f.scrollHeight<=f.clientHeight?1:f.scrollTop/(f.scrollHeight-f.clientHeight)};this.refresh=function(f){f?(n="",x()):m()};this.processingTime=function(){return g};var q=!0,w=function(f){var y=c.preview,G=y.parentNode,M=y.nextSibling;G.removeChild(y);y.innerHTML=f;M?G.insertBefore(y,M):G.appendChild(y)},F=function(f){c.preview.innerHTML=f},J,h=function(f){if(J)return J(f);try{F(f),J=F}catch(y){J=w,J(f)}},D=function(f){var y=R.getTop(c.input)-
l();c.preview&&(h(f),d());c.preview&&(c.preview.scrollTop=(c.preview.scrollHeight-c.preview.clientHeight)*u(c.preview));if(q)q=!1;else{var G=R.getTop(c.input)-l();P.isIE?setTimeout(function(){window.scrollBy(0,G-y)},0):window.scrollBy(0,G-y)}};(function(f,y){A.addEvent(f,"input",y);f.onpaste=y;f.ondrop=y;A.addEvent(f,"keypress",y);A.addEvent(f,"keydown",y)})(c.input,m);x();c.preview&&(c.preview.scrollTop=0)}function S(a,c,d,e,g,n,l,x,m){function u(f){J.focus();if(f.textOp){e&&e.setCommandMode();var y=
new W(c);if(!y)return;var G=y.getChunks(),M=function(){J.focus();G&&y.setChunks(G);y.restore();g.refresh()};f.textOp(G,M)||M()}f.execute&&f.execute(e)}function q(f,y){var G=f.getElementsByTagName("span")[0];y?(G.style.backgroundPosition=f.XShift+" 0px",f.onmouseover=function(){G.style.backgroundPosition=this.XShift+" -40px"},f.onmouseout=function(){G.style.backgroundPosition=this.XShift+" 0px"},P.isIE&&(f.onmousedown=function(){v.activeElement&&v.activeElement!==c.input||(c.ieCachedRange=document.selection.createRange(),
c.ieCachedScrollTop=c.input.scrollTop)}),f.isHelp||(f.onclick=function(){if(this.onmouseout)this.onmouseout();u(this);return!1})):(G.style.backgroundPosition=f.XShift+" -20px",f.onmouseover=f.onmouseout=f.onclick=function(){})}function w(f){"string"===typeof f&&(f=n[f]);return function(){f.apply(n,arguments)}}function F(){e&&(q(h.undo,e.canUndo()),q(h.redo,e.canRedo()))}var J=c.input,h={};(function(){var f=c.buttonBar,y=document.createElement("ul");y.id="wmd-button-row"+a;y.className="wmd-button-row";
y=f.appendChild(y);var G=0;f=function(H,L,fa,ca){var Q=document.createElement("li");Q.className="wmd-button";Q.style.left=G+"px";G+=25;var b=document.createElement("span");Q.id=H+a;Q.appendChild(b);Q.title=L;Q.XShift=fa;ca&&(Q.textOp=ca);q(Q,!0);y.appendChild(Q);return Q};var M=function(H){var L=document.createElement("li");L.className="wmd-spacer wmd-spacer"+H;L.id="wmd-spacer"+H+a;y.appendChild(L);G+=25};h.bold=f("wmd-bold-button",m("bold"),"0px",w("doBold"));h.italic=f("wmd-italic-button",m("italic"),
"-20px",w("doItalic"));M(1);h.link=f("wmd-link-button",m("link"),"-40px",w(function(H,L){return this.doLinkOrImage(H,L,!1)}));h.quote=f("wmd-quote-button",m("quote"),"-60px",w("doBlockquote"));h.code=f("wmd-code-button",m("code"),"-80px",w("doCode"));h.image=f("wmd-image-button",m("image"),"-100px",w(function(H,L){return this.doLinkOrImage(H,L,!0)}));M(2);h.olist=f("wmd-olist-button",m("olist"),"-120px",w(function(H,L){this.doList(H,L,!0)}));h.ulist=f("wmd-ulist-button",m("ulist"),"-140px",w(function(H,
L){this.doList(H,L,!1)}));h.heading=f("wmd-heading-button",m("heading"),"-160px",w("doHeading"));h.hr=f("wmd-hr-button",m("hr"),"-180px",w("doHorizontalRule"));h.more=f("wmd-more-button",m("more"),"-280px",w("doMore"));M(3);h.undo=f("wmd-undo-button",m("undo"),"-200px",null);h.undo.execute=function(H){H&&H.undo()};var ba=/win/.test(X.platform.toLowerCase())?m("redo"):m("redomac");h.redo=f("wmd-redo-button",ba,"-220px",null);h.redo.execute=function(H){H&&H.redo()};M(4);h.fullscreen=f("wmd-fullscreen-button",
m("fullscreen"),"-240px",null);h.fullscreen.execute=function(){l.doFullScreen(h,!0)};h.exitFullscreen=f("wmd-exit-fullscreen-button",m("exitFullscreen"),"-260px",null);h.exitFullscreen.style.display="none";h.exitFullscreen.execute=function(){l.doFullScreen(h,!1)};d.makeButton(h,f,w,O);x&&(f=document.createElement("li"),M=document.createElement("span"),f.appendChild(M),f.className="wmd-button wmd-help-button",f.id="wmd-help-button"+a,f.XShift="-300px",f.isHelp=!0,f.style.right="0px",f.title=m("help"),
f.onclick=x.handler,q(f,!0),y.appendChild(f),h.help=f);F()})();var D="keydown";P.isOpera&&(D="keypress");A.addEvent(J,D,function(f){if((f.ctrlKey||f.metaKey)&&!f.altKey&&!f.shiftKey){switch(String.fromCharCode(f.charCode||f.keyCode).toLowerCase()){case "b":u(h.bold);break;case "i":u(h.italic);break;case "l":u(h.link);break;case "q":u(h.quote);break;case "k":u(h.code);break;case "g":u(h.image);break;case "o":u(h.olist);break;case "u":u(h.ulist);break;case "m":u(h.more);break;case "j":u(h.fullscreen);
break;case "e":u(h.exitFullscreen);break;case "h":u(h.heading);break;case "r":u(h.hr);break;case "y":u(h.redo);break;case "z":f.shiftKey?u(h.redo):u(h.undo);break;default:return}f.preventDefault&&f.preventDefault();window.event&&(window.event.returnValue=!1)}else if(9==f.keyCode&&window.fullScreenEntered){var y={};y.textOp=w("doTab");u(y);f.preventDefault&&f.preventDefault();window.event&&(window.event.returnValue=!1)}});A.addEvent(J,"keyup",function(f){!f.shiftKey||f.ctrlKey||f.metaKey||13!==(f.charCode||
f.keyCode)||(f={},f.textOp=w("doAutoindent"),u(f))});P.isIE&&A.addEvent(J,"keydown",function(f){if(27===f.keyCode)return!1});this.setUndoRedoButtonStates=F}function U(a,c){this.hooks=a;this.getString=c}function aa(a){return a.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(c,d,e){var g=!1;d=d.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^\w\d-./[\]]/g,function(n){if(3===n.length&&"%"==n.charAt(0))return n.toUpperCase();switch(n){case "?":return g=!0,"?";case "+":if(g)return"%20"}return encodeURI(n)});e&&(e=
e.trim?e.trim():e.replace(/^\s*/,"").replace(/\s*$/,""),e=e.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));return e?d+' "'+e+'"':d})}function N(a,c){this.fullScreenBind=!1;this.hooks=a;this.getString=c;this.isFakeFullScreen=!1}function Y(){var a={fullScreenChange:["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange"],requestFullscreen:["requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen",
"msRequestFullScreen"],cancelFullscreen:["cancelFullscreen","exitFullScreen","webkitCancelFullScreen","mozCancelFullScreen","msCancelFullScreen"]},c={},d;for(d in a){for(var e=a[d].length,g=!1,n=0;n<e;n++){var l=a[d][n];if("undefined"!=typeof document[l]||"undefined"!=typeof document.body[l]){c[d]=l;g=!0;break}}if(!g)return!1}return c}function V(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msIsFullScreen}var A={},R={},O={},v=window.document,K=RegExp,
X=window.navigator,P={isIE:/msie/.test(X.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(X.userAgent.toLowerCase())||/msie 5/.test(X.userAgent.toLowerCase()),isOpera:/opera/.test(X.userAgent.toLowerCase())},ea={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',linkname:null,
quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",imagename:null,olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",
litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",more:"More contents \x3c!--more--\x3e Ctrl+M",fullscreen:"FullScreen Ctrl+J",exitFullscreen:"Exit FullScreen Ctrl+E",fullscreenUnsupport:"Sorry, the browser dont support fullscreen api",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",ok:"OK",cancel:"Cancel",help:"Markdown Editing Help"};Markdown.Editor=function(a,c,d){d=d||{};"function"===typeof d.handler&&(d={helpButton:d});
d.strings=d.strings||{};d.helpButton&&(d.strings.help=d.strings.help||d.helpButton.title);var e=function(x){var m=d.strings[x]||ea[x];if("imagename"==x||"linkname"==x)d.strings[x]=null;return m};c=c||"";var g=this.hooks=new Markdown.HookCollection;g.addNoop("onPreviewRefresh");g.addNoop("postBlockquoteCreation");g.addFalse("insertImageDialog");g.addFalse("insertLinkDialog");g.addNoop("makeButton");g.addNoop("enterFullScreen");g.addNoop("enterFakeFullScreen");g.addNoop("exitFullScreen");this.getConverter=
function(){return a};var n=this,l;this.run=function(){if(!l){l=new da(c);var x=new U(g,e),m=new E(a,l,function(){g.onPreviewRefresh()});if(!/\?noundo/.test(v.location.href)){var u=new Z(function(){m.refresh();q&&q.setUndoRedoButtonStates()},l);this.textOperation=function(w){u.setCommandMode();w();n.refreshPreview()}}fullScreenManager=new N(g,e);var q=new S(c,l,g,u,m,x,fullScreenManager,d.helpButton,e);q.setUndoRedoButtonStates();(n.refreshPreview=function(){m.refresh(!0)})()}}};T.prototype.findTags=
function(a,c){var d=this;if(a){var e=A.extendRegExp(a,"","$");this.before=this.before.replace(e,function(g){d.startTag+=g;return""});e=A.extendRegExp(a,"^","");this.selection=this.selection.replace(e,function(g){d.startTag+=g;return""})}c&&(e=A.extendRegExp(c,"","$"),this.selection=this.selection.replace(e,function(g){d.endTag=g+d.endTag;return""}),e=A.extendRegExp(c,"^",""),this.after=this.after.replace(e,function(g){d.endTag=g+d.endTag;return""}))};T.prototype.trimWhitespace=function(a){var c,d=
this;a?a=c="":(a=function(e){d.before+=e;return""},c=function(e){d.after=e+d.after;return""});this.selection=this.selection.replace(/^(\s*)/,a).replace(/(\s*)$/,c)};T.prototype.skipLines=function(a,c,d){void 0===a&&(a=1);void 0===c&&(c=1);a++;c++;var e,g;navigator.userAgent.match(/Chrome/)&&"X".match(/()./);this.selection=this.selection.replace(/(^\n*)/,"");this.startTag+=K.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag+=K.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before+=
K.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after+=K.$1;if(this.before){for(e=g="";a--;)e+="\\n?",g+="\n";d&&(e="\\n*");this.before=this.before.replace(new K(e+"$",""),g)}if(this.after){for(e=g="";c--;)e+="\\n?",g+="\n";d&&(e="\\n*");this.after=this.after.replace(new K(e,""),g)}};A.isVisible=function(a){if(window.getComputedStyle)return"none"!==window.getComputedStyle(a,null).getPropertyValue("display");if(a.currentStyle)return"none"!==a.currentStyle.display};A.addEvent=function(a,c,d){a.attachEvent?
a.attachEvent("on"+c,d):a.addEventListener(c,d,!1)};A.removeEvent=function(a,c,d){a.detachEvent?a.detachEvent("on"+c,d):a.removeEventListener(c,d,!1)};A.fixEolChars=function(a){a=a.replace(/\r\n/g,"\n");return a=a.replace(/\r/g,"\n")};A.extendRegExp=function(a,c,d){if(null===c||void 0===c)c="";if(null===d||void 0===d)d="";a=a.toString();var e;a=a.replace(/\/([gim]*)$/,function(g,n){e=n;return""});a=a.replace(/(^\/|\/$)/g,"");return new K(c+a+d,e)};R.getTop=function(a,c){var d=a.offsetTop;if(!c)for(;a=
a.offsetParent;)d+=a.offsetTop;return d};R.getHeight=function(a){return a.offsetHeight||a.scrollHeight};R.getWidth=function(a){return a.offsetWidth||a.scrollWidth};R.getPageSize=function(){if(self.innerHeight&&self.scrollMaxY){var a=v.body.scrollWidth;var c=self.innerHeight+self.scrollMaxY}else v.body.scrollHeight>v.body.offsetHeight?(a=v.body.scrollWidth,c=v.body.scrollHeight):(a=v.body.offsetWidth,c=v.body.offsetHeight);if(self.innerHeight){var d=self.innerWidth;var e=self.innerHeight}else v.documentElement&&
v.documentElement.clientHeight?(d=v.documentElement.clientWidth,e=v.documentElement.clientHeight):v.body&&(d=v.body.clientWidth,e=v.body.clientHeight);return[Math.max(a,d),Math.max(c,e),d,e]};O.createBackground=function(){var a=v.createElement("div"),c=a.style;a.className="wmd-prompt-background";c.position="absolute";c.top="0";c.zIndex="1000";P.isIE?c.filter="alpha(opacity=50)":c.opacity="0.5";var d=R.getPageSize();c.height=d[1]+"px";P.isIE?(c.left=v.documentElement.scrollLeft,c.width=v.documentElement.clientWidth):
(c.left="0",c.width="100%");v.body.appendChild(a);return a};O.dialog=function(a,c,d,e){var g,n=function(m){27===(m.charCode||m.keyCode)&&l(!0)},l=function(m){A.removeEvent(v.body,"keydown",n);g.parentNode.removeChild(g);c(m);return!1},x=function(){g=v.createElement("div");g.className="wmd-prompt-dialog";g.setAttribute("role","dialog");var m=v.createElement("div"),u=v.createElement("form");u.onsubmit=function(){return l(!1)};g.appendChild(u);u.appendChild(m);"function"==typeof a?a.call(this,m):m.innerHTML=
a;m=v.createElement("button");m.type="button";m.className="btn btn-s primary";m.onclick=function(){return l(!1)};m.innerHTML=d;var q=v.createElement("button");q.type="button";q.className="btn btn-s";q.onclick=function(){return l(!0)};q.innerHTML=e;u.appendChild(m);u.appendChild(q);A.addEvent(v.body,"keydown",n);v.body.appendChild(g)};setTimeout(function(){x()},0)};O.prompt=function(a,c,d,e,g){var n,l;void 0===c&&(c="");var x=function(q){27===(q.charCode||q.keyCode)&&m(!0)},m=function(q){A.removeEvent(v.body,
"keydown",x);var w=l.value;q?w=null:(w=w.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(w)||/^[_a-z0-9-]+:/i.test(w)||(w="http://"+w));n.parentNode.removeChild(n);d(w);return!1},u=function(){n=v.createElement("div");n.className="wmd-prompt-dialog";n.setAttribute("role","dialog");var q=v.createElement("div");q.innerHTML=a;n.appendChild(q);q=v.createElement("form");q.onsubmit=function(){return m(!1)};n.appendChild(q);l=v.createElement("input");l.type="text";l.value=c;q.appendChild(l);
var w=v.createElement("button");w.type="button";w.className="btn btn-s primary";w.onclick=function(){return m(!1)};w.innerHTML=e;var F=v.createElement("button");F.type="button";F.className="btn btn-s";F.onclick=function(){return m(!0)};F.innerHTML=g;q.appendChild(w);q.appendChild(F);A.addEvent(v.body,"keydown",x);v.body.appendChild(n)};setTimeout(function(){u();var q=c.length;if(void 0!==l.selectionStart)l.selectionStart=0,l.selectionEnd=q;else if(l.createTextRange){var w=l.createTextRange();w.collapse(!1);
w.moveStart("character",-q);w.moveEnd("character",q);w.select()}l.focus()},0)};var I=U.prototype;I.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";I.unwrap=function(a){var c=new K("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");a.selection=a.selection.replace(c,"$1 $2")};I.wrap=function(a,c){this.unwrap(a);c=new K("(.{1,"+c+"})( +|$\\n?)","gm");var d=this;a.selection=a.selection.replace(c,function(e,g){return(new K("^"+d.prefixes,"")).test(e)?e:g+"\n"});a.selection=
a.selection.replace(/\s+$/,"")};I.doBold=function(a,c){return this.doBorI(a,c,2,this.getString("boldexample"))};I.doItalic=function(a,c){return this.doBorI(a,c,1,this.getString("italicexample"))};I.doBorI=function(a,c,d,e){a.trimWhitespace();a.selection=a.selection.replace(/\n{2,}/g,"\n");var g=/(\**$)/.exec(a.before)[0];c=/(^\**)/.exec(a.after)[0];g=Math.min(g.length,c.length);g>=d&&(2!=g||1!=d)?(a.before=a.before.replace(K("[*]{"+d+"}$",""),""),a.after=a.after.replace(K("^[*]{"+d+"}",""),"")):!a.selection&&
c?(a.after=a.after.replace(/^([*_]*)/,""),a.before=a.before.replace(/(\s?)$/,""),a.before=a.before+c+K.$1):(a.selection||c||(a.selection=e),d=1>=d?"*":"**",a.before+=d,a.after=d+a.after)};I.stripLinkDefs=function(a,c){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(d,e,g,n,l){c[e]=d.replace(/\s*$/,"");return n?(c[e]=d.replace(/["(](.+?)[")]$/,""),n+l):""})};I.addLinkDef=function(a,c){var d=0,e={};a.before=this.stripLinkDefs(a.before,
e);a.selection=this.stripLinkDefs(a.selection,e);a.after=this.stripLinkDefs(a.after,e);var g="",n=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,l=function(m){d++;m=m.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+d+"]:");g+="\n"+m},x=function(m,u,q,w,F,J){q=q.replace(n,x);return e[F]?(l(e[F]),u+q+w+d+J):m};a.before=a.before.replace(n,x);c?l(c):a.selection=a.selection.replace(n,x);c=d;a.after=a.after.replace(n,x);a.after&&(a.after=a.after.replace(/\n*$/,""));a.after||(a.selection=a.selection.replace(/\n*$/,
""));a.after+="\n\n"+g;return c};I.doLinkOrImage=function(a,c,d){a.trimWhitespace();a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(1<a.endTag.length&&0<a.startTag.length)a.startTag=a.startTag.replace(/!?\[/,""),a.endTag="",this.addLinkDef(a,null);else if(a.selection=a.startTag+a.selection+a.endTag,a.startTag=a.endTag="",/\n\n/.test(a.selection))this.addLinkDef(a,null);else{var e=this,g=function(l){n.parentNode.removeChild(n);null!==l&&(a.selection=(" "+a.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,
"$1\\").substr(1),l=" [999]: "+aa(l),l=e.addLinkDef(a,l),a.startTag=d?"![":"[",a.endTag="]["+l+"]",a.selection||(d?(l=e.getString("imagename"),a.selection=l||e.getString("imagedescription")):(l=e.getString("linkname"),a.selection=l||e.getString("linkdescription"))));c()};var n=O.createBackground();d?this.hooks.insertImageDialog(g)||O.prompt(this.getString("imagedialog"),"http://",g,this.getString("ok"),this.getString("cancel")):this.hooks.insertLinkDialog(g)||O.prompt(this.getString("linkdialog"),
"http://",g,this.getString("ok"),this.getString("cancel"));return!0}};I.doAutoindent=function(a,c){c=!1;a.before=a.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");a.before=a.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");a.before=a.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");a.selection||/^[ \t]*(?:\n|$)/.test(a.after)||(a.after=a.after.replace(/^[^\n]*/,function(d){a.selection=d;return""}),c=!0);/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(a.before)&&this.doList&&this.doList(a);
/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(a.before)&&this.doBlockquote&&this.doBlockquote(a);/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&this.doCode&&this.doCode(a);c&&(a.after=a.selection+a.after,a.selection="")};I.doBlockquote=function(a,c){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(m,u,q,w){a.before+=u;a.after=w+a.after;return q});a.before=a.before.replace(/(>[ \t]*)$/,function(m,u){a.selection=u+a.selection;return""});a.selection=a.selection.replace(/^(\s|>)+$/,"");a.selection=a.selection||
this.getString("quoteexample");var d=c="";if(a.before){for(var e=a.before.replace(/\n$/,"").split("\n"),g=!1,n=0;n<e.length;n++){var l=!1;var x=e[n];g=g&&0<x.length;/^>/.test(x)?(l=!0,!g&&1<x.length&&(g=!0)):l=/^[ \t]*$/.test(x)?!0:g;l?c+=x+"\n":(d+=c+x,c="\n")}/(^|\n)>/.test(c)||(d+=c,c="")}a.startTag=c;a.before=d;a.after&&(a.after=a.after.replace(/^\n?/,"\n"));a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(m){a.endTag=m;return""});c=function(m){var u=m?"> ":"";a.startTag&&
(a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(q,w){return"\n"+w.replace(/^[ ]{0,3}>?[ \t]*$/gm,u)+"\n"}));a.endTag&&(a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(q,w){return"\n"+w.replace(/^[ ]{0,3}>?[ \t]*$/gm,u)+"\n"}))};/^(?![ ]{0,3}>)/m.test(a.selection)?(this.wrap(a,70),a.selection=a.selection.replace(/^/gm,"> "),c(!0),a.skipLines()):(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(a),c(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,
"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag&&(a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n")));a.selection=this.hooks.postBlockquoteCreation(a.selection);/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(m,u){a.startTag+=u;return""}))};I.doCode=function(a,c){c=/\S[ ]*$/.test(a.before);if(!/^[ ]*\S/.test(a.after)&&!c||/\n/.test(a.selection)){a.before=a.before.replace(/[ ]{4}$/,function(e){a.selection=e+a.selection;return""});var d=c=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&
(c=0);/^\n(\t|[ ]{4,})/.test(a.after)&&(d=0);a.skipLines(c,d);a.selection?/^[ ]{0,3}\S/m.test(a.selection)?/\n/.test(a.selection)?a.selection=a.selection.replace(/^/gm,"    "):a.before+="    ":a.selection=a.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(a.startTag="    ",a.selection=this.getString("codeexample"))}else a.trimWhitespace(),a.findTags(/`/,/`/),a.startTag||a.endTag?a.endTag&&!a.startTag?(a.before+=a.endTag,a.endTag=""):a.startTag=a.endTag="":(a.startTag=a.endTag="`",a.selection||(a.selection=
this.getString("codeexample")))};I.doList=function(a,c,d){c=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var e="-",g=1,n=function(){if(d){var q=" "+g+". ";g++}else q=" "+e+" ";return q},l=function(q){void 0===d&&(d=/^\s*\d/.test(q));return q=q.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(w){return n()})};a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);!a.before||/\n$/.test(a.before)||/^\n/.test(a.startTag)||(a.before+=a.startTag,a.startTag=
"");if(a.startTag){var x=/\d+[.]/.test(a.startTag);a.startTag="";a.selection=a.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(a);a.skipLines();x&&(a.after=a.after.replace(c,l));if(d==x)return}var m=1;a.before=a.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(q){/^\s*([*+-])/.test(q)&&(e=K.$1);m=/[^\n]\n\n[^\n]/.test(q)?1:0;return l(q)});a.selection||(a.selection=this.getString("litem"));x=n();var u=1;a.after=a.after.replace(c,
function(q){u=/[^\n]\n\n[^\n]/.test(q)?1:0;return l(q)});a.trimWhitespace(!0);a.skipLines(m,u,!0);a.startTag=x;c=x.replace(/./g," ");this.wrap(a,72-c.length);a.selection=a.selection.replace(/\n/g,"\n"+c)};I.doHeading=function(a,c){a.selection=a.selection.replace(/\s+/g," ");a.selection=a.selection.replace(/(^\s+|\s+$)/g,"");if(a.selection){if(c=0,a.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(a.startTag)&&(c=K.lastMatch.length),a.startTag=a.endTag="",a.findTags(null,/\s?(-+|=+)/),/=+/.test(a.endTag)&&(c=
1),/-+/.test(a.endTag)&&(c=2),a.startTag=a.endTag="",a.skipLines(1,1),c=0==c?2:c-1,0<c){c=2<=c?"-":"=";var d=a.selection.length;72<d&&(d=72);for(a.endTag="\n";d--;)a.endTag+=c}}else a.startTag="## ",a.selection=this.getString("headingexample"),a.endTag=" ##"};I.doHorizontalRule=function(a,c){a.startTag="----------\n";a.selection="";a.skipLines(2,1,!0)};I.doMore=function(a,c){a.startTag="\x3c!--more--\x3e\n\n";a.selection="";a.skipLines(2,0,!0)};I.doTab=function(a,c){a.startTag="    ";a.selection=
""};N.prototype.doFullScreen=function(a,c){var d=Y(),e=this;if(!d)return alert(e.getString("fullscreenUnsupport")),!1;this.fullScreenBind||(A.addEvent(document,d.fullScreenChange.substring(2),function(){V()?(a.fullscreen.style.display="none",a.exitFullscreen.style.display="",e.hooks.enterFullScreen()):(a.fullscreen.style.display="",a.exitFullscreen.style.display="none",e.hooks.exitFullScreen())}),this.fullScreenBind=!0);if(c)e.isFakeFullScreen?(document.body[d.requestFullscreen]("webkitRequestFullScreen"==
d.requestFullscreen?Element.ALLOW_KEYBOARD_INPUT:null),e.isFakeFullScreen=!1):V()||(a.exitFullscreen.style.display="",e.hooks.enterFakeFullScreen(),e.isFakeFullScreen=!0),window.fullScreenEntered=!0;else{if(e.isFakeFullScreen)a.exitFullscreen.style.display="none",e.hooks.exitFullScreen();else if(V())document[d.cancelFullscreen]();e.isFakeFullScreen=!1;window.fullScreenEntered=!1}}})();
